!function(e,t){"object"==typeof module&&module.exports&&"function"==typeof require?module.exports=t():"function"==typeof define&&"object"==typeof define.amd?define(t):e.log=t()}(this,function(){function e(e){return typeof console===a?!1:void 0!==console[e]?t(console,e):void 0!==console.log?t(console,"log"):c}function t(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(o){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function n(e,t){return function(){typeof console!==a&&(o(t),s[e].apply(s,arguments))}}function o(e){for(var t=0;t<u.length;t++){var n=u[t];s[n]=e>t?c:s.methodFactory(n,e)}}function r(e){var t=(u[e]||"silent").toUpperCase();try{return void(window.localStorage.loglevel=t)}catch(n){}try{window.document.cookie="loglevel="+t+";"}catch(n){}}function i(){var e;try{e=window.localStorage.loglevel}catch(t){}if(typeof e===a)try{e=/loglevel=([^;]+)/.exec(window.document.cookie)[1]}catch(t){}void 0===s.levels[e]&&(e="WARN"),s.setLevel(s.levels[e])}var s={},c=function(){},a="undefined",u=["trace","debug","info","warn","error"];s.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},s.methodFactory=function(t,o){return e(t)||n(t,o)},s.setLevel=function(e){if("string"==typeof e&&void 0!==s.levels[e.toUpperCase()]&&(e=s.levels[e.toUpperCase()]),!("number"==typeof e&&e>=0&&e<=s.levels.SILENT))throw"log.setLevel() called with invalid level: "+e;return r(e),o(e),typeof console===a&&e<s.levels.SILENT?"No console available for logging":void 0},s.enableAll=function(){s.setLevel(s.levels.TRACE)},s.disableAll=function(){s.setLevel(s.levels.SILENT)};var l=typeof window!==a?window.log:void 0;return s.noConflict=function(){return typeof window!==a&&window.log===s&&(window.log=l),s},i(),s}),this.org=this.org||{},org.cometd={},org.cometd.CometD=function(e){function t(e,t){try{return e[t]}catch(n){return void 0}}function n(e){return org.cometd.Utils.isString(e)}function o(e){return void 0===e||null===e?!1:"function"==typeof e}function r(e,t){if(window.console){var n=window.console[e];o(n)&&n.apply(window.console,t)}}function i(e){it._debug("Configuring cometd object with",e),n(e)&&(e={url:e}),e||(e={}),xt=it._mixin(!1,xt,e);var t=it.getURL();if(!t)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";var o=/(^https?:\/\/)?(((\[[^\]]+\])|([^:\/\?#]+))(:(\d+))?)?([^\?#]*)(.*)?/.exec(t),r=o[2],i=o[8],s=o[9];if(ct=it._isCrossDomain(r),xt.appendMessageTypeToURL)if(void 0!==s&&s.length>0)it._info("Appending message type to URI "+i+s+" is not supported, disabling 'appendMessageTypeToURL' configuration"),xt.appendMessageTypeToURL=!1;else{var c=i.split("/"),a=c.length-1;i.match(/\/$/)&&(a-=1),c[a].indexOf(".")>=0&&(it._info("Appending message type to URI "+i+" is not supported, disabling 'appendMessageTypeToURL' configuration"),xt.appendMessageTypeToURL=!1)}}function s(e){if(e){var t=pt[e.channel];t&&t[e.id]&&(delete t[e.id],it._debug("Removed",e.listener?"listener":"subscription",e))}}function c(e){e&&!e.listener&&s(e)}function a(){for(var e in pt){var t=pt[e];if(t)for(var n=0;n<t.length;++n)c(t[n])}}function u(e){ut!==e&&(it._debug("Status",ut,"->",e),ut=e)}function l(){return"disconnecting"===ut||"disconnected"===ut}function f(){return++lt}function d(e,t,n,r,i){try{return t.call(e,r)}catch(s){it._debug("Exception during execution of extension",n,s);var c=it.onExtensionException;if(o(c)){it._debug("Invoking extension exception callback",n,s);try{c.call(it,s,n,i,r)}catch(a){it._info("Exception during execution of exception callback in extension",n,a)}}return r}}function g(e){for(var t=0;t<bt.length&&(void 0!==e&&null!==e);++t){var n=xt.reverseIncomingExtensions?bt.length-1-t:t,r=bt[n],i=r.extension.incoming;if(o(i)){var s=d(r.extension,i,r.name,e,!1);e=void 0===s?e:s}}return e}function h(e){for(var t=0;t<bt.length&&(void 0!==e&&null!==e);++t){var n=bt[t],r=n.extension.outgoing;if(o(r)){var i=d(n.extension,r,n.name,e,!0);e=void 0===i?e:i}}return e}function p(e,t){var n=pt[e];if(n&&n.length>0)for(var r=0;r<n.length;++r){var i=n[r];if(i)try{i.callback.call(i.scope,t)}catch(s){it._debug("Exception during notification",i,t,s);var c=it.onListenerException;if(o(c)){it._debug("Invoking listener exception callback",i,s);try{c.call(it,s,i,i.listener,t)}catch(a){it._info("Exception during execution of listener callback",i,a)}}}}}function m(e,t){p(e,t);for(var n=e.split("/"),o=n.length-1,r=o;r>0;--r){var i=n.slice(0,r).join("/")+"/*";r===o&&p(i,t),i+="*",p(i,t)}}function v(){null!==vt&&org.cometd.Utils.clearTimeout(vt),vt=null}function b(e){v();var t=yt.interval+mt;it._debug("Function scheduled in",t,"ms, interval =",yt.interval,"backoff =",mt,e),vt=org.cometd.Utils.setTimeout(it,e,t)}function y(e,t,n,r){for(var i=0;i<t.length;++i){var s=t[i],c=""+f();s.id=c,ft&&(s.clientId=ft);var a=void 0;o(s._callback)&&(a=s._callback,delete s._callback),s=h(s),void 0!==s&&null!==s?(s.id=c,t[i]=s,a&&(Tt[c]=a)):t.splice(i--,1)}if(0!==t.length){var u=it.getURL();xt.appendMessageTypeToURL&&(u.match(/\/$/)||(u+="/"),r&&(u+=r));var l={url:u,sync:e,messages:t,onSuccess:function(e){try{_t.call(it,e)}catch(t){it._debug("Exception during handling of messages",t)}},onFailure:function(e,t,n){try{var o=it.getTransport();n.connectionType=o?o.getType():"unknown",St.call(it,e,t,n)}catch(r){it._debug("Exception during handling of failure",r)}}};it._debug("Send",l),nt.send(l,n)}}function T(e){dt>0||ht===!0?gt.push(e):y(!1,[e],!1)}function w(){mt=0}function k(){mt<xt.maxBackoff&&(mt+=xt.backoffIncrement)}function x(){++dt}function _(){var e=gt;gt=[],e.length>0&&y(!1,e,!1)}function S(){if(--dt,0>dt)throw"Calls to startBatch() and endBatch() are not paired";0!==dt||l()||ht||_()}function C(){if(!l()){var e={channel:"/meta/connect",connectionType:nt.getType()};kt||(e.advice={timeout:0}),u("connecting"),it._debug("Connect sent",e),y(!1,[e],!0,"connect"),u("connected")}}function L(){u("connecting"),b(function(){C()})}function R(e){e&&(yt=it._mixin(!1,{},xt.advice,e),it._debug("New advice",yt))}function U(e){if(v(),e&&nt&&nt.abort(),ft=null,u("disconnected"),dt=0,w(),nt=null,gt.length>0){var t=gt;gt=[],St.call(it,void 0,t,{reason:"Disconnected"})}}function I(e,t,n){var r=it.onTransportFailure;if(o(r)){it._debug("Invoking transport failure callback",e,t,n);try{r.call(it,e,t,n)}catch(i){it._info("Exception during execution of transport failure callback",i)}}}function E(e,t){o(e)&&(t=e,e=void 0),ft=null,a(),l()?(at.reset(),R(xt.advice)):R(it._mixin(!1,yt,{reconnect:"retry"})),dt=0,ht=!0,ot=e,rt=t;var n="1.0",r=it.getURL(),i=at.findTransportTypes(n,ct,r),s={version:n,minimumVersion:n,channel:"/meta/handshake",supportedConnectionTypes:i,_callback:t,advice:{timeout:yt.timeout,interval:yt.interval}},c=it._mixin(!1,{},ot,s);if(!nt&&(nt=at.negotiateTransport(i,n,ct,r),!nt)){var f="Could not find initial transport among: "+at.getTransportTypes();throw it._warn(f),f}it._debug("Initial transport is",nt.getType()),u("handshaking"),it._debug("Handshake sent",c),y(!1,[c],!1,"handshake")}function N(){u("handshaking"),ht=!0,b(function(){E(ot,rt)})}function q(e){var t=Tt[e.id];o(t)&&(delete Tt[e.id],t.call(it,e))}function A(e){q(e),m("/meta/handshake",e),m("/meta/unsuccessful",e);var t=!l()&&"none"!==yt.reconnect;t?(k(),N()):U(!1)}function O(e){if(e.successful){ft=e.clientId;var t=it.getURL(),n=at.negotiateTransport(e.supportedConnectionTypes,e.version,ct,t);if(null===n){var o="Could not negotiate transport with server; client=["+at.findTransportTypes(e.version,ct,t)+"], server=["+e.supportedConnectionTypes+"]",r=it.getTransport();return I(r.getType(),null,{reason:o,connectionType:r.getType(),transport:r}),it._warn(o),void U(!0)}nt!==n&&(it._debug("Transport",nt.getType(),"->",n.getType()),nt=n),ht=!1,_(),e.reestablish=wt,wt=!0,q(e),m("/meta/handshake",e);var i=l()?"none":yt.reconnect;switch(i){case"retry":w(),L();break;case"none":U(!1);break;default:throw"Unrecognized advice action "+i}}else A(e)}function F(e){var t="1.0",n=it.getURL(),o=it.getTransport(),r=at.findTransportTypes(t,ct,n),i=at.negotiateTransport(r,t,ct,n);i?(it._debug("Transport",o.getType(),"->",i.getType()),I(o.getType(),i.getType(),e.failure),A(e),nt=i):(I(o.getType(),null,e.failure),it._warn("Could not negotiate transport; client=["+r+"]"),U(!0),A(e))}function j(e){m("/meta/connect",e),m("/meta/unsuccessful",e);var t=l()?"none":yt.reconnect;switch(t){case"retry":L(),k();break;case"handshake":at.reset(),w(),N();break;case"none":U(!1);break;default:throw"Unrecognized advice action"+t}}function J(e){if(kt=e.successful){m("/meta/connect",e);var t=l()?"none":yt.reconnect;switch(t){case"retry":w(),L();break;case"none":U(!1);break;default:throw"Unrecognized advice action "+t}}else j(e)}function B(e){kt=!1,j(e)}function M(e){U(!0),q(e),m("/meta/disconnect",e),m("/meta/unsuccessful",e)}function W(e){e.successful?(U(!1),q(e),m("/meta/disconnect",e)):M(e)}function D(e){M(e)}function P(e){var t=pt[e.subscription];if(t)for(var n=t.length-1;n>=0;--n){var o=t[n];if(o&&!o.listener){delete t[n],it._debug("Removed failed subscription",o);break}}q(e),m("/meta/subscribe",e),m("/meta/unsuccessful",e)}function H(e){e.successful?(q(e),m("/meta/subscribe",e)):P(e)}function z(e){P(e)}function X(e){q(e),m("/meta/unsubscribe",e),m("/meta/unsuccessful",e)}function Z(e){e.successful?(q(e),m("/meta/unsubscribe",e)):X(e)}function $(e){X(e)}function G(e){q(e),m("/meta/publish",e),m("/meta/unsuccessful",e)}function Q(e){void 0===e.successful?void 0!==e.data?m(e.channel,e):it._warn("Unknown Bayeux Message",e):e.successful?(q(e),m("/meta/publish",e)):G(e)}function V(e){G(e)}function K(e){if(e=g(e),void 0!==e&&null!==e){R(e.advice);var t=e.channel;switch(t){case"/meta/handshake":O(e);break;case"/meta/connect":J(e);break;case"/meta/disconnect":W(e);break;case"/meta/subscribe":H(e);break;case"/meta/unsubscribe":Z(e);break;default:Q(e)}}}function Y(e){var t=pt[e];if(t)for(var n=0;n<t.length;++n)if(t[n])return!0;return!1}function et(e,t){var r={scope:e,method:t};if(o(e))r.scope=void 0,r.method=e;else if(n(t)){if(!e)throw"Invalid scope "+e;if(r.method=e[t],!o(r.method))throw"Invalid callback "+t+" for scope "+e}else if(!o(t))throw"Invalid callback "+t;return r}function tt(e,t,n,o){var r=et(t,n);it._debug("Adding",o?"listener":"subscription","on",e,"with scope",r.scope,"and callback",r.method);var i={channel:e,scope:r.scope,callback:r.method,listener:o},s=pt[e];return s||(s=[],pt[e]=s),i.id=s.push(i)-1,it._debug("Added",o?"listener":"subscription",i),i[0]=e,i[1]=i.id,i}var nt,ot,rt,it=this,st=e||"default",ct=!1,at=new org.cometd.TransportRegistry,ut="disconnected",lt=0,ft=null,dt=0,gt=[],ht=!1,pt={},mt=0,vt=null,bt=[],yt={},Tt={},wt=!1,kt=!1,xt={protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",reverseIncomingExtensions:!0,maxNetworkDelay:1e4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,advice:{timeout:6e4,interval:0,reconnect:"retry"}};this._mixin=function(e,n){for(var o=n||{},r=2;r<arguments.length;++r){var i=arguments[r];if(void 0!==i&&null!==i)for(var s in i){var c=t(i,s),a=t(o,s);if(c!==n&&void 0!==c)if(e&&"object"==typeof c&&null!==c)if(c instanceof Array)o[s]=this._mixin(e,a instanceof Array?a:[],c);else{var u="object"!=typeof a||a instanceof Array?{}:a;o[s]=this._mixin(e,u,c)}else o[s]=c}}return o},this._warn=function(){r("warn",arguments)},this._info=function(){"warn"!==xt.logLevel&&r("info",arguments)},this._debug=function(){"debug"===xt.logLevel&&r("debug",arguments)},this._isCrossDomain=function(e){return e&&e!==window.location.host};var _t,St;this.send=T,this.receive=K,_t=function(e){it._debug("Received",e);for(var t=0;t<e.length;++t){var n=e[t];K(n)}},St=function(e,t,n){it._debug("handleFailure",e,t,n),n.transport=e;for(var o=0;o<t.length;++o){var r=t[o],i={id:r.id,successful:!1,channel:r.channel,failure:n};switch(n.message=r,r.channel){case"/meta/handshake":F(i);break;case"/meta/connect":B(i);break;case"/meta/disconnect":D(i);break;case"/meta/subscribe":i.subscription=r.subscription,z(i);break;case"/meta/unsubscribe":i.subscription=r.subscription,$(i);break;default:V(i)}}},this.registerTransport=function(e,t,n){var r=at.add(e,t,n);return r&&(this._debug("Registered transport",e),o(t.registered)&&t.registered(e,this)),r},this.notifyListeners=m,this.getTransportTypes=function(){return at.getTransportTypes()},this.unregisterTransport=function(e){var t=at.remove(e);return null!==t&&(this._debug("Unregistered transport",e),o(t.unregistered)&&t.unregistered()),t},this.unregisterTransports=function(){at.clear()},this.findTransport=function(e){return at.find(e)},this.configure=function(e){i.call(this,e)},this.init=function(e,t){this.configure(e),this.handshake(t)},this.handshake=function(e,t){u("disconnected"),wt=!1,E(e,t)},this.disconnect=function(e,t,n){if(!l()){"boolean"!=typeof e&&(n=t,t=e,e=!1),o(t)&&(n=t,t=void 0);var r={channel:"/meta/disconnect",_callback:n},i=this._mixin(!1,{},t,r);u("disconnecting"),y(e===!0,[i],!1,"disconnect")}},this.startBatch=function(){x()},this.endBatch=function(){S()},this.batch=function(e,t){var n=et(e,t);this.startBatch();try{n.method.call(n.scope),this.endBatch()}catch(o){throw this._info("Exception during execution of batch",o),this.endBatch(),o}},this.addListener=function(e,t,o){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!n(e))throw"Illegal argument type: channel must be a string";return tt(e,t,o,!0)},this.removeListener=function(e){if(!(e&&e.channel&&"id"in e))throw"Invalid argument: expected subscription, not "+e;s(e)},this.clearListeners=function(){pt={}},this.subscribe=function(e,t,r,i,s){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!n(e))throw"Illegal argument type: channel must be a string";if(l())throw"Illegal state: already disconnected";o(t)&&(s=i,i=r,r=t,t=void 0),o(i)&&(s=i,i=void 0);var c=!Y(e),a=tt(e,t,r,!1);if(c){var u={channel:"/meta/subscribe",subscription:e,_callback:s},f=this._mixin(!1,{},i,u);T(f)}return a},this.unsubscribe=function(e,t,n){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(l())throw"Illegal state: already disconnected";o(t)&&(n=t,t=void 0),this.removeListener(e);var r=e.channel;if(!Y(r)){var i={channel:"/meta/unsubscribe",subscription:r,_callback:n},s=this._mixin(!1,{},t,i);T(s)}},this.resubscribe=function(e,t){return c(e),e?this.subscribe(e.channel,e.scope,e.callback,t):void 0},this.clearSubscriptions=function(){a()},this.publish=function(e,t,r,i){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!n(e))throw"Illegal argument type: channel must be a string";if(/^\/meta\//.test(e))throw"Illegal argument: cannot publish to meta channels";if(l())throw"Illegal state: already disconnected";o(t)?(i=t,t=r={}):o(r)&&(i=r,r={});var s={channel:e,data:t,_callback:i},c=this._mixin(!1,{},r,s);T(c)},this.getStatus=function(){return ut},this.isDisconnected=l,this.setBackoffIncrement=function(e){xt.backoffIncrement=e},this.getBackoffIncrement=function(){return xt.backoffIncrement},this.getBackoffPeriod=function(){return mt},this.setLogLevel=function(e){xt.logLevel=e},this.registerExtension=function(e,t){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!n(e))throw"Illegal argument type: extension name must be a string";for(var r=!1,i=0;i<bt.length;++i){var s=bt[i];if(s.name===e){r=!0;break}}return r?(this._info("Could not register extension with name",e,"since another extension with the same name already exists"),!1):(bt.push({name:e,extension:t}),this._debug("Registered extension",e),o(t.registered)&&t.registered(e,this),!0)},this.unregisterExtension=function(e){if(!n(e))throw"Illegal argument type: extension name must be a string";for(var t=!1,r=0;r<bt.length;++r){var i=bt[r];if(i.name===e){bt.splice(r,1),t=!0,this._debug("Unregistered extension",e);var s=i.extension;o(s.unregistered)&&s.unregistered();break}}return t},this.getExtension=function(e){for(var t=0;t<bt.length;++t){var n=bt[t];if(n.name===e)return n.extension}return null},this.getName=function(){return st},this.getClientId=function(){return ft},this.getURL=function(){if(nt&&"object"==typeof xt.urls){var e=xt.urls[nt.getType()];if(e)return e}return xt.url},this.getTransport=function(){return nt},this.getConfiguration=function(){return this._mixin(!0,{},xt)},this.getAdvice=function(){return this._mixin(!0,{},yt)},org.cometd.WebSocket=window.WebSocket},org.cometd.Utils={},org.cometd.Utils.isString=function(e){return void 0===e||null===e?!1:"string"==typeof e||e instanceof String},org.cometd.Utils.isArray=function(e){return void 0===e||null===e?!1:e instanceof Array},org.cometd.Utils.inArray=function(e,t){for(var n=0;n<t.length;++n)if(e===t[n])return n;return-1},org.cometd.Utils.setTimeout=function(e,t,n){return window.setTimeout(function(){try{e._debug("Invoking timed function",t),t()}catch(n){e._debug("Exception invoking timed function",t,n)}},n)},org.cometd.Utils.clearTimeout=function(e){window.clearTimeout(e)},org.cometd.JSON={},org.cometd.JSON.toJSON=org.cometd.JSON.fromJSON=function(){throw"Abstract"},org.cometd.Transport=function(){var e,t;this.registered=function(n,o){e=n,t=o},this.unregistered=function(){e=null,t=null},this._debug=function(){t._debug.apply(t,arguments)},this._mixin=function(){return t._mixin.apply(t,arguments)},this.getConfiguration=function(){return t.getConfiguration()},this.getAdvice=function(){return t.getAdvice()},this.setTimeout=function(e,n){return org.cometd.Utils.setTimeout(t,e,n)},this.clearTimeout=function(e){org.cometd.Utils.clearTimeout(e)},this.convertToMessages=function(e){if(org.cometd.Utils.isString(e))try{return org.cometd.JSON.fromJSON(e)}catch(t){throw this._debug("Could not convert to JSON the following string",'"'+e+'"'),t}if(org.cometd.Utils.isArray(e))return e;if(void 0===e||null===e)return[];if(e instanceof Object)return[e];throw"Conversion Error "+e+", typeof "+typeof e},this.accept=function(){throw"Abstract"},this.getType=function(){return e},this.send=function(){throw"Abstract"},this.reset=function(){this._debug("Transport",e,"reset")},this.abort=function(){this._debug("Transport",e,"aborted")},this.toString=function(){return this.getType()}},org.cometd.Transport.derive=function(e){function t(){}return t.prototype=e,new t},org.cometd.RequestTransport=function(){function e(e){for(;f.length>0;){var t=f[0],n=t[0],o=t[1];if(n.url!==e.url||n.sync!==e.sync)break;f.shift(),e.messages=e.messages.concat(n.messages),this._debug("Coalesced",n.messages.length,"messages from request",o.id)}}function t(e,t){if(this.transportSend(e,t),t.expired=!1,!e.sync){var n=this.getConfiguration().maxNetworkDelay,o=n;t.metaConnect===!0&&(o+=this.getAdvice().timeout),this._debug("Transport",this.getType(),"waiting at most",o,"ms for the response, maxNetworkDelay",n);var r=this;t.timeout=this.setTimeout(function(){t.expired=!0;var n="Request "+t.id+" of transport "+r.getType()+" exceeded "+o+" ms max network delay",i={reason:n},s=t.xhr;i.httpCode=r.xhrStatus(s),r.abortXHR(s),r._debug(n),r.complete(t,!1,t.metaConnect),e.onFailure(s,e.messages,i)},o)}}function n(e){var n=++a,o={id:n,metaConnect:!1};l.length<this.getConfiguration().maxConnections-1?(l.push(o),t.call(this,e,o)):(this._debug("Transport",this.getType(),"queueing request",n,"envelope",e),f.push([e,o]))}function o(e){var t=e.id;if(this._debug("Transport",this.getType(),"metaConnect complete, request",t),null!==u&&u.id!==t)throw"Longpoll request mismatch, completing request "+t;u=null}function r(t,o){var r=org.cometd.Utils.inArray(t,l);if(r>=0&&l.splice(r,1),f.length>0){var i=f.shift(),s=i[0],c=i[1];if(this._debug("Transport dequeued request",c.id),o)this.getConfiguration().autoBatch&&e.call(this,s),n.call(this,s),this._debug("Transport completed request",t.id,s);else{var a=this;this.setTimeout(function(){a.complete(c,!1,c.metaConnect);var e={reason:"Previous request failed"},t=c.xhr;e.httpCode=a.xhrStatus(t),s.onFailure(t,s.messages,e)},0)}}}function i(e){if(null!==u)throw"Concurrent metaConnect requests not allowed, request id="+u.id+" not yet completed";var n=++a;this._debug("Transport",this.getType(),"metaConnect send, request",n,"envelope",e);var o={id:n,metaConnect:!0};t.call(this,e,o),u=o}var s=new org.cometd.Transport,c=org.cometd.Transport.derive(s),a=0,u=null,l=[],f=[];return c.complete=function(e,t,n){n?o.call(this,e):r.call(this,e,t)},c.transportSend=function(){throw"Abstract"},c.transportSuccess=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!0,t.metaConnect),n&&n.length>0?e.onSuccess(n):e.onFailure(t.xhr,e.messages,{httpCode:204}))},c.transportFailure=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!1,t.metaConnect),e.onFailure(t.xhr,e.messages,n))},c.send=function(e,t){t?i.call(this,e):n.call(this,e)},c.abort=function(){s.abort();for(var e=0;e<l.length;++e){var t=l[e];this._debug("Aborting request",t),this.abortXHR(t.xhr)}u&&(this._debug("Aborting metaConnect request",u),this.abortXHR(u.xhr)),this.reset()},c.reset=function(){s.reset(),u=null,l=[],f=[]},c.abortXHR=function(e){if(e)try{e.abort()}catch(t){this._debug(t)}},c.xhrStatus=function(e){if(e)try{return e.status}catch(t){this._debug(t)}return-1},c},org.cometd.TransportRegistry=function(){var e=[],t={};this.getTransportTypes=function(){return e.slice(0)},this.findTransportTypes=function(n,o,r){for(var i=[],s=0;s<e.length;++s){var c=e[s];t[c].accept(n,o,r)===!0&&i.push(c)}return i},this.negotiateTransport=function(n,o,r,i){for(var s=0;s<e.length;++s)for(var c=e[s],a=0;a<n.length;++a)if(c===n[a]){var u=t[c];if(u.accept(o,r,i)===!0)return u}return null},this.add=function(n,o,r){for(var i=!1,s=0;s<e.length;++s)if(e[s]===n){i=!0;break}return i||("number"!=typeof r?e.push(n):e.splice(r,0,n),t[n]=o),!i},this.find=function(n){for(var o=0;o<e.length;++o)if(e[o]===n)return t[n];return null},this.remove=function(n){for(var o=0;o<e.length;++o)if(e[o]===n){e.splice(o,1);var r=t[n];return delete t[n],r}return null},this.clear=function(){e=[],t={}},this.reset=function(){for(var n=0;n<e.length;++n)t[e[n]].reset()}},org.cometd.WebSocketTransport=function(){function e(){if(!f){f=!0;var e=o.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",e);try{var t=o.getConfiguration().protocol,n=t?new org.cometd.WebSocket(e,t):new org.cometd.WebSocket(e)}catch(r){throw s=!1,this._debug("Exception while creating WebSocket object",r),r}a=o.getConfiguration().stickyReconnect!==!1;var i=this,c=null,u=o.getConfiguration().connectTimeout;u>0&&(c=this.setTimeout(function(){c=null,i._debug("Transport",i.getType(),"timed out while connecting to URL",e,":",u,"ms");var t={code:1e3,reason:"Connect Timeout"};i.webSocketClose(n,t.code,t.reason),i.onClose(n,t)},u));var l=function(){i._debug("WebSocket opened",n),f=!1,c&&(i.clearTimeout(c),c=null),d?(o._warn("Closing Extra WebSocket Connections",n,d),i.webSocketClose(n,1e3,"Extra Connection")):i.onOpen(n)},g=function(e){e=e||{code:1e3},i._debug("WebSocket closing",n,e),f=!1,c&&(i.clearTimeout(c),c=null),null!==d&&n!==d?i._debug("Closed Extra WebSocket Connection",n):i.onClose(n,e)},h=function(e){i._debug("WebSocket message",e,n),n!==d&&o._warn("Extra WebSocket Connections",n,d),i.onMessage(n,e)};n.onopen=l,n.onclose=g,n.onerror=function(){g({code:1002,reason:"Error"})},n.onmessage=h,this._debug("Transport",this.getType(),"configured callbacks on",n)}}function t(e,t,n){var o=org.cometd.JSON.toJSON(t.messages);e.send(o),this._debug("Transport",this.getType(),"sent",t,"metaConnect =",n);var r=this.getConfiguration().maxNetworkDelay,i=r;n&&(i+=this.getAdvice().timeout,g=!0);for(var s=this,c=[],a=0;a<t.messages.length;++a)!function(){var n=t.messages[a];n.id&&(c.push(n.id),l[n.id]=this.setTimeout(function(){s._debug("Transport",s.getType(),"timing out message",n.id,"after",i,"on",e);var t={code:1e3,reason:"Message Timeout"};s.webSocketClose(e,t.code,t.reason),s.onClose(e,t)},i))}();this._debug("Transport",this.getType(),"waiting at most",i,"ms for messages",c,"maxNetworkDelay",r,", timeouts:",l)}function n(n,o,r){try{null===n?e.call(this):t.call(this,n,o,r)}catch(i){this.setTimeout(function(){o.onFailure(n,o.messages,{exception:i})},0)}}var o,r=new org.cometd.Transport,i=org.cometd.Transport.derive(r),s=!0,c=!1,a=!0,u={},l={},f=!1,d=null,g=!1,h=null;return i.reset=function(){r.reset(),s=!0,c=!1,a=!0,u={},l={},f=!1,d=null,g=!1,h=null},i.onOpen=function(e){this._debug("Transport",this.getType(),"opened",e),d=e,c=!0,this._debug("Sending pending messages",u);for(var n in u){var o=u[n],r=o[0],i=o[1];h=r.onSuccess,t.call(this,e,r,i)}},i.onMessage=function(e,t){this._debug("Transport",this.getType(),"received websocket message",t,e);for(var n=!1,o=this.convertToMessages(t.data),r=[],i=0;i<o.length;++i){var s=o[i];if((/^\/meta\//.test(s.channel)||void 0!==s.successful)&&s.id){r.push(s.id);var c=l[s.id];c&&(this.clearTimeout(c),delete l[s.id],this._debug("Transport",this.getType(),"removed timeout for message",s.id,", timeouts",l))}"/meta/connect"===s.channel&&(g=!1),"/meta/disconnect"!==s.channel||g||(n=!0)}for(var a=!1,f=0;f<r.length;++f){var d=r[f];for(var p in u){var m=p.split(","),v=org.cometd.Utils.inArray(d,m);if(v>=0){a=!0,m.splice(v,1);var b=u[p][0],y=u[p][1];delete u[p],m.length>0&&(u[m.join(",")]=[b,y]);break}}}a&&this._debug("Transport",this.getType(),"removed envelope, envelopes",u),h.call(this,o),n&&this.webSocketClose(e,1e3,"Disconnect")},i.onClose=function(e,t){this._debug("Transport",this.getType(),"closed",e,t),s=a&&c;var n=l;l={};for(var o in n)this.clearTimeout(n[o]);var r=u;u={};for(var i in r){var f=r[i][0],h=r[i][1];h&&(g=!1),f.onFailure(e,f.messages,{websocketCode:t.code,reason:t.reason})}d=null},i.registered=function(e,t){r.registered(e,t),o=t},i.accept=function(){return s&&!!org.cometd.WebSocket&&o.websocketEnabled!==!1},i.send=function(e,t){this._debug("Transport",this.getType(),"sending",e,"metaConnect =",t);for(var o=[],r=0;r<e.messages.length;++r){var i=e.messages[r];i.id&&o.push(i.id)}u[o.join(",")]=[e,t],this._debug("Transport",this.getType(),"stored envelope, envelopes",u),n.call(this,d,e,t)},i.webSocketClose=function(e,t,n){try{e.close(t,n)}catch(o){this._debug(o)}},i.abort=function(){if(r.abort(),d){var e={code:1001,reason:"Abort"};this.webSocketClose(d,e.code,e.reason),this.onClose(d,e)}this.reset()},i},org.cometd.LongPollingTransport=function(){var e=new org.cometd.RequestTransport,t=org.cometd.Transport.derive(e),n=!0;return t.accept=function(e,t){return n||!t},t.xhrSend=function(){throw"Abstract"},t.transportSend=function(e,t){this._debug("Transport",this.getType(),"sending request",t.id,"envelope",e);var o=this;try{var r=!0;t.xhr=this.xhrSend({transport:this,url:e.url,sync:e.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(e.messages),onSuccess:function(r){o._debug("Transport",o.getType(),"received response",r);var i=!1;try{var s=o.convertToMessages(r);0===s.length?(n=!1,o.transportFailure(e,t,{httpCode:204})):(i=!0,o.transportSuccess(e,t,s))}catch(c){if(o._debug(c),!i){n=!1;var a={exception:c};a.httpCode=o.xhrStatus(t.xhr),o.transportFailure(e,t,a)}}},onError:function(i,s){n=!1;var c={reason:i,exception:s};c.httpCode=o.xhrStatus(t.xhr),r?o.setTimeout(function(){o.transportFailure(e,t,c)},0):o.transportFailure(e,t,c)}}),r=!1}catch(i){n=!1,this.setTimeout(function(){o.transportFailure(e,t,{exception:i})},0)}},t.reset=function(){e.reset(),n=!0},t},org.cometd.CallbackPollingTransport=function(){function e(e,t,n){var o=this;return function(){o.transportFailure(e,t,"error",n)}}var t=new org.cometd.RequestTransport,n=org.cometd.Transport.derive(t),o=2e3;return n.accept=function(){return!0},n.jsonpSend=function(){throw"Abstract"},n.transportSend=function(t,n){for(var r=this,i=0,s=t.messages.length,c=[];s>0;){var a=org.cometd.JSON.toJSON(t.messages.slice(i,i+s)),u=t.url.length+encodeURI(a).length;if(u>o){if(1===s){var l="Bayeux message too big ("+u+" bytes, max is "+o+") for transport "+this.getType();return void this.setTimeout(e.call(this,t,n,l),0)}--s}else c.push(s),i+=s,s=t.messages.length-i}var f=t;if(c.length>1){var d=0,g=c[0];this._debug("Transport",this.getType(),"split",t.messages.length,"messages into",c.join(" + ")),f=this._mixin(!1,{},t),f.messages=t.messages.slice(d,g),f.onSuccess=t.onSuccess,f.onFailure=t.onFailure;for(var h=1;h<c.length;++h){var p=this._mixin(!1,{},t);d=g,g+=c[h],p.messages=t.messages.slice(d,g),p.onSuccess=t.onSuccess,p.onFailure=t.onFailure,this.send(p,n.metaConnect)}}this._debug("Transport",this.getType(),"sending request",n.id,"envelope",f);try{var m=!0;this.jsonpSend({transport:this,url:f.url,sync:f.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(f.messages),onSuccess:function(e){var t=!1;try{var o=r.convertToMessages(e);0===o.length?r.transportFailure(f,n,{httpCode:204}):(t=!0,r.transportSuccess(f,n,o))}catch(i){r._debug(i),t||r.transportFailure(f,n,{exception:i})}},onError:function(e,t){var o={reason:e,exception:t};m?r.setTimeout(function(){r.transportFailure(f,n,o)},0):r.transportFailure(f,n,o)}}),m=!1}catch(v){this.setTimeout(function(){r.transportFailure(f,n,{exception:v})},0)}},n},function(){function e(e,t){function n(e,t){if(t)for(var n in t)"content-type"!==n.toLowerCase()&&e.setRequestHeader(n,t[n])}function o(){var o=new t.LongPollingTransport,r=t.Transport.derive(o);return r.xhrSend=function(t){return e.ajax({url:t.url,async:t.sync!==!0,type:"POST",contentType:"application/json;charset=UTF-8",data:t.body,global:!1,xhrFields:{withCredentials:!0},beforeSend:function(e){return e.withCredentials=!0,n(e,t.headers),!0},success:t.onSuccess,error:function(e,n,o){t.onError(n,o)}})},r}function r(){var o=new t.CallbackPollingTransport,r=t.Transport.derive(o);return r.jsonpSend=function(t){e.ajax({url:t.url,async:t.sync!==!0,type:"GET",dataType:"jsonp",jsonp:"jsonp",data:{message:t.body},beforeSend:function(e){return n(e,t.headers),!0},success:t.onSuccess,error:function(e,n,o){t.onError(n,o)}})},r}return t.JSON.toJSON=JSON.stringify,t.JSON.fromJSON=JSON.parse,e.CometD=function(e){var n=new t.CometD(e);return t.WebSocket&&n.registerTransport("websocket",new t.WebSocketTransport),n.registerTransport("long-polling",new o),n.registerTransport("callback-polling",new r),n},e.cometd=new e.CometD,e.cometd}"function"==typeof define&&define.amd?define(["jquery","org/cometd"],e):e(jQuery,org.cometd)}(),function(){"use strict";function e(){}var t,n=new e,o=e.prototype,r=this,i=r.ZetaPush,s=$.cometd,c=null,a=!1,u=[];s.addListener("/meta/connect",function(e){if(s.isDisconnected())return a=!1,void log.info("connection closed");var t=a;a=e.successful,!t&&a?(log.info("connection established"),s.notifyListeners("/meta/connected",e),s.batch(function(){n.refresh()})):t&&!a&&log.warn("connection broken")}),s.addListener("/meta/handshake",function(e){e.successful?(log.debug("successful handshake",e),t=e.clientId):(log.warn("unsuccessful handshake"),t=null)}),o.isConnected=function(){return s.isConnected()},o.generateChannel=function(e,t,n){return"/service/"+e+"/"+t+"/"+n},o.on=function(e,t){var n=e.split("/");if(n.length<=1)return null;var o={};return"service"==n[1]?(o.isService=!0,o.channel=e,o.callback=t,a?(o.sub=s.subscribe(o.channel,o.callback),log.debug("subscribed",o)):log.debug("queuing subscription request",o),u.push(o),null==o.renewOnReconnect&&(o.renewOnReconnect=!0),o):"meta"!=n[1]?(log.error("This event can t be managed by ZetaPush",e),null):(o.isService=!1,o.renewOnReconnect=!1,o.channel=e,o.callback=t,o.sub=s.addListener(e,t),o)},o.off=function(e){e&&null!=e.sub&&(e.isService?(s.unsubscribe(e.sub),e.sub=null):(s.removeListener(e.sub),e.sub=null),log.debug("unsubscribed",e),e.renewOnReconnect=!1)},o.send=function(e,t){var n=e.split("/");n.length<=1||"service"==n[1]&&a&&s.publish(e,t)},o.init=function(e,t){log.setLevel(t),"debug"==t&&(s.websocketEnabled=!1),s.configure({url:e,logLevel:t,backoffIncrement:100,maxBackoff:500,appendMessageTypeToURL:!1})
},o.disconnect=function(){s.disconnect(!0)},s.onListenerException=function(e,t,n,o){log.error("Uncaught exception for subscription",t,":",e,"message:",o),n?(s.removeListener(t),log.error("removed listener")):(s.unsubscribe(t),log.error("unsubscribed")),disconnect()},o.refresh=function(){log.debug("refreshing subscriptions");var e=[];u.forEach(function(t){t.sub&&t.isService&&s.unsubscribe(t.sub),t.renewOnReconnect&&e.push(t)}),u=[],e.forEach(function(e){o.on(e.channel,e.callback)})},o.makeResourceId=function(){for(var e="",t="abcdefghijklmnopqrstuvwxyz0123456789",n=0;5>n;n++)e+=t.charAt(Math.floor(Math.random()*t.length));localStorage.resource=e},o.connect=function(e){c=e,s.handshake(e)},o.reconnect=function(){connect(c)},e.noConflict=function(){return r.ZetaPush=i,n},"function"==typeof define&&define.amd?define(function(){return n}):"object"==typeof module&&module.exports?module.exports=n:r.zetaPush=n}.call(this);