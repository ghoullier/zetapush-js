!function(e,t){"object"==typeof module&&module.exports&&"function"==typeof require?module.exports=t():"function"==typeof define&&"object"==typeof define.amd?define(t):e.log=t()}(this,function(){function e(e){return typeof console===a?!1:void 0!==console[e]?t(console,e):void 0!==console.log?t(console,"log"):c}function t(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(r){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function n(e,t){return function(){typeof console!==a&&(r(t),s[e].apply(s,arguments))}}function r(e){for(var t=0;t<u.length;t++){var n=u[t];s[n]=e>t?c:s.methodFactory(n,e)}}function o(e){var t=(u[e]||"silent").toUpperCase();try{return void(window.localStorage.loglevel=t)}catch(n){}try{window.document.cookie="loglevel="+t+";"}catch(n){}}function i(){var e;try{e=window.localStorage.loglevel}catch(t){}if(typeof e===a)try{e=/loglevel=([^;]+)/.exec(window.document.cookie)[1]}catch(t){}void 0===s.levels[e]&&(e="WARN"),s.setLevel(s.levels[e])}var s={},c=function(){},a="undefined",u=["trace","debug","info","warn","error"];s.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},s.methodFactory=function(t,r){return e(t)||n(t,r)},s.setLevel=function(e){if("string"==typeof e&&void 0!==s.levels[e.toUpperCase()]&&(e=s.levels[e.toUpperCase()]),!("number"==typeof e&&e>=0&&e<=s.levels.SILENT))throw"log.setLevel() called with invalid level: "+e;return o(e),r(e),typeof console===a&&e<s.levels.SILENT?"No console available for logging":void 0},s.enableAll=function(){s.setLevel(s.levels.TRACE)},s.disableAll=function(){s.setLevel(s.levels.SILENT)};var l=typeof window!==a?window.log:void 0;return s.noConflict=function(){return typeof window!==a&&window.log===s&&(window.log=l),s},i(),s}),function(){"use strict";function e(){}function t(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function n(e){return function(){return this[e].apply(this,arguments)}}var r=e.prototype,o=this,i=o.EventEmitter;r.getListeners=function(e){var t,n,r=this._getEvents();if(e instanceof RegExp){t={};for(n in r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n])}else t=r[e]||(r[e]=[]);return t},r.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},r.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},r.addListener=function(e,n){var r,o=this.getListenersAsObject(e),i="object"==typeof n;for(r in o)o.hasOwnProperty(r)&&-1===t(o[r],n)&&o[r].push(i?n:{listener:n,once:!1});return this},r.on=n("addListener"),r.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},r.once=n("addOnceListener"),r.defineEvent=function(e){return this.getListeners(e),this},r.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},r.removeListener=function(e,n){var r,o,i=this.getListenersAsObject(e);for(o in i)i.hasOwnProperty(o)&&(r=t(i[o],n),-1!==r&&i[o].splice(r,1));return this},r.off=n("removeListener"),r.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},r.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},r.manipulateListeners=function(e,t,n){var r,o,i=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(r=n.length;r--;)i.call(this,t,n[r]);else for(r in t)t.hasOwnProperty(r)&&(o=t[r])&&("function"==typeof o?i.call(this,r,o):s.call(this,r,o));return this},r.removeEvent=function(e){var t,n=typeof e,r=this._getEvents();if("string"===n)delete r[e];else if(e instanceof RegExp)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this},r.removeAllListeners=n("removeEvent"),r.emitEvent=function(e,t){var n,r,o,i,s=this.getListenersAsObject(e);for(o in s)if(s.hasOwnProperty(o))for(r=s[o].length;r--;)n=s[o][r],n.once===!0&&this.removeListener(e,n.listener),i=n.listener.apply(this,t||[]),i===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},r.trigger=n("emitEvent"),r.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},r.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},r._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},r._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return o.EventEmitter=i,e},"function"==typeof define&&define.amd?define(function(){return e}):"object"==typeof module&&module.exports?module.exports=e:o.EventEmitter=e}.call(this),this.org=this.org||{},org.cometd={},org.cometd.CometD=function(e){function t(e,t){try{return e[t]}catch(n){return void 0}}function n(e){return org.cometd.Utils.isString(e)}function r(e){return void 0===e||null===e?!1:"function"==typeof e}function o(e,t){if(window.console){var n=window.console[e];r(n)&&n.apply(window.console,t)}}function i(e){it._debug("Configuring cometd object with",e),n(e)&&(e={url:e}),e||(e={}),xt=it._mixin(!1,xt,e);var t=it.getURL();if(!t)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";var r=/(^https?:\/\/)?(((\[[^\]]+\])|([^:\/\?#]+))(:(\d+))?)?([^\?#]*)(.*)?/.exec(t),o=r[2],i=r[8],s=r[9];if(ct=it._isCrossDomain(o),xt.appendMessageTypeToURL)if(void 0!==s&&s.length>0)it._info("Appending message type to URI "+i+s+" is not supported, disabling 'appendMessageTypeToURL' configuration"),xt.appendMessageTypeToURL=!1;else{var c=i.split("/"),a=c.length-1;i.match(/\/$/)&&(a-=1),c[a].indexOf(".")>=0&&(it._info("Appending message type to URI "+i+" is not supported, disabling 'appendMessageTypeToURL' configuration"),xt.appendMessageTypeToURL=!1)}}function s(e){if(e){var t=pt[e.channel];t&&t[e.id]&&(delete t[e.id],it._debug("Removed",e.listener?"listener":"subscription",e))}}function c(e){e&&!e.listener&&s(e)}function a(){for(var e in pt){var t=pt[e];if(t)for(var n=0;n<t.length;++n)c(t[n])}}function u(e){ut!==e&&(it._debug("Status",ut,"->",e),ut=e)}function l(){return"disconnecting"===ut||"disconnected"===ut}function f(){return++lt}function d(e,t,n,o,i){try{return t.call(e,o)}catch(s){it._debug("Exception during execution of extension",n,s);var c=it.onExtensionException;if(r(c)){it._debug("Invoking extension exception callback",n,s);try{c.call(it,s,n,i,o)}catch(a){it._info("Exception during execution of exception callback in extension",n,a)}}return o}}function g(e){for(var t=0;t<bt.length&&(void 0!==e&&null!==e);++t){var n=xt.reverseIncomingExtensions?bt.length-1-t:t,o=bt[n],i=o.extension.incoming;if(r(i)){var s=d(o.extension,i,o.name,e,!1);e=void 0===s?e:s}}return e}function h(e){for(var t=0;t<bt.length&&(void 0!==e&&null!==e);++t){var n=bt[t],o=n.extension.outgoing;if(r(o)){var i=d(n.extension,o,n.name,e,!0);e=void 0===i?e:i}}return e}function p(e,t){var n=pt[e];if(n&&n.length>0)for(var o=0;o<n.length;++o){var i=n[o];if(i)try{i.callback.call(i.scope,t)}catch(s){it._debug("Exception during notification",i,t,s);var c=it.onListenerException;if(r(c)){it._debug("Invoking listener exception callback",i,s);try{c.call(it,s,i,i.listener,t)}catch(a){it._info("Exception during execution of listener callback",i,a)}}}}}function m(e,t){p(e,t);for(var n=e.split("/"),r=n.length-1,o=r;o>0;--o){var i=n.slice(0,o).join("/")+"/*";o===r&&p(i,t),i+="*",p(i,t)}}function v(){null!==vt&&org.cometd.Utils.clearTimeout(vt),vt=null}function b(e){v();var t=yt.interval+mt;it._debug("Function scheduled in",t,"ms, interval =",yt.interval,"backoff =",mt,e),vt=org.cometd.Utils.setTimeout(it,e,t)}function y(e,t,n,o){for(var i=0;i<t.length;++i){var s=t[i],c=""+f();s.id=c,ft&&(s.clientId=ft);var a=void 0;r(s._callback)&&(a=s._callback,delete s._callback),s=h(s),void 0!==s&&null!==s?(s.id=c,t[i]=s,a&&(Tt[c]=a)):t.splice(i--,1)}if(0!==t.length){var u=it.getURL();xt.appendMessageTypeToURL&&(u.match(/\/$/)||(u+="/"),o&&(u+=o));var l={url:u,sync:e,messages:t,onSuccess:function(e){try{kt.call(it,e)}catch(t){it._debug("Exception during handling of messages",t)}},onFailure:function(e,t,n){try{var r=it.getTransport();n.connectionType=r?r.getType():"unknown",St.call(it,e,t,n)}catch(o){it._debug("Exception during handling of failure",o)}}};it._debug("Send",l),nt.send(l,n)}}function T(e){dt>0||ht===!0?gt.push(e):y(!1,[e],!1)}function w(){mt=0}function _(){mt<xt.maxBackoff&&(mt+=xt.backoffIncrement)}function x(){++dt}function k(){var e=gt;gt=[],e.length>0&&y(!1,e,!1)}function S(){if(--dt,0>dt)throw"Calls to startBatch() and endBatch() are not paired";0!==dt||l()||ht||k()}function C(){if(!l()){var e={channel:"/meta/connect",connectionType:nt.getType()};_t||(e.advice={timeout:0}),u("connecting"),it._debug("Connect sent",e),y(!1,[e],!0,"connect"),u("connected")}}function L(){u("connecting"),b(function(){C()})}function E(e){e&&(yt=it._mixin(!1,{},xt.advice,e),it._debug("New advice",yt))}function R(e){if(v(),e&&nt&&nt.abort(),ft=null,u("disconnected"),dt=0,w(),nt=null,gt.length>0){var t=gt;gt=[],St.call(it,void 0,t,{reason:"Disconnected"})}}function O(e,t,n){var o=it.onTransportFailure;if(r(o)){it._debug("Invoking transport failure callback",e,t,n);try{o.call(it,e,t,n)}catch(i){it._info("Exception during execution of transport failure callback",i)}}}function U(e,t){r(e)&&(t=e,e=void 0),ft=null,a(),l()?(at.reset(),E(xt.advice)):E(it._mixin(!1,yt,{reconnect:"retry"})),dt=0,ht=!0,rt=e,ot=t;var n="1.0",o=it.getURL(),i=at.findTransportTypes(n,ct,o),s={version:n,minimumVersion:n,channel:"/meta/handshake",supportedConnectionTypes:i,_callback:t,advice:{timeout:yt.timeout,interval:yt.interval}},c=it._mixin(!1,{},rt,s);if(!nt&&(nt=at.negotiateTransport(i,n,ct,o),!nt)){var f="Could not find initial transport among: "+at.getTransportTypes();throw it._warn(f),f}it._debug("Initial transport is",nt.getType()),u("handshaking"),it._debug("Handshake sent",c),y(!1,[c],!1,"handshake")}function I(){u("handshaking"),ht=!0,b(function(){U(rt,ot)})}function A(e){var t=Tt[e.id];r(t)&&(delete Tt[e.id],t.call(it,e))}function N(e){A(e),m("/meta/handshake",e),m("/meta/unsuccessful",e);var t=!l()&&"none"!==yt.reconnect;t?(_(),I()):R(!1)}function q(e){if(e.successful){ft=e.clientId;var t=it.getURL(),n=at.negotiateTransport(e.supportedConnectionTypes,e.version,ct,t);if(null===n){var r="Could not negotiate transport with server; client=["+at.findTransportTypes(e.version,ct,t)+"], server=["+e.supportedConnectionTypes+"]",o=it.getTransport();return O(o.getType(),null,{reason:r,connectionType:o.getType(),transport:o}),it._warn(r),void R(!0)}nt!==n&&(it._debug("Transport",nt.getType(),"->",n.getType()),nt=n),ht=!1,k(),e.reestablish=wt,wt=!0,A(e),m("/meta/handshake",e);var i=l()?"none":yt.reconnect;switch(i){case"retry":w(),L();break;case"none":R(!1);break;default:throw"Unrecognized advice action "+i}}else N(e)}function F(e){var t="1.0",n=it.getURL(),r=it.getTransport(),o=at.findTransportTypes(t,ct,n),i=at.negotiateTransport(o,t,ct,n);i?(it._debug("Transport",r.getType(),"->",i.getType()),O(r.getType(),i.getType(),e.failure),N(e),nt=i):(O(r.getType(),null,e.failure),it._warn("Could not negotiate transport; client=["+o+"]"),R(!0),N(e))}function j(e){m("/meta/connect",e),m("/meta/unsuccessful",e);var t=l()?"none":yt.reconnect;switch(t){case"retry":L(),_();break;case"handshake":at.reset(),w(),I();break;case"none":R(!1);break;default:throw"Unrecognized advice action"+t}}function J(e){if(_t=e.successful){m("/meta/connect",e);var t=l()?"none":yt.reconnect;switch(t){case"retry":w(),L();break;case"none":R(!1);break;default:throw"Unrecognized advice action "+t}}else j(e)}function P(e){_t=!1,j(e)}function B(e){R(!0),A(e),m("/meta/disconnect",e),m("/meta/unsuccessful",e)}function D(e){e.successful?(R(!1),A(e),m("/meta/disconnect",e)):B(e)}function M(e){B(e)}function W(e){var t=pt[e.subscription];if(t)for(var n=t.length-1;n>=0;--n){var r=t[n];if(r&&!r.listener){delete t[n],it._debug("Removed failed subscription",r);break}}A(e),m("/meta/subscribe",e),m("/meta/unsuccessful",e)}function H(e){e.successful?(A(e),m("/meta/subscribe",e)):W(e)}function V(e){W(e)}function Z(e){A(e),m("/meta/unsubscribe",e),m("/meta/unsuccessful",e)}function z(e){e.successful?(A(e),m("/meta/unsubscribe",e)):Z(e)}function X(e){Z(e)}function $(e){A(e),m("/meta/publish",e),m("/meta/unsuccessful",e)}function G(e){void 0===e.successful?void 0!==e.data?m(e.channel,e):it._warn("Unknown Bayeux Message",e):e.successful?(A(e),m("/meta/publish",e)):$(e)}function Q(e){$(e)}function K(e){if(e=g(e),void 0!==e&&null!==e){E(e.advice);var t=e.channel;switch(t){case"/meta/handshake":q(e);break;case"/meta/connect":J(e);break;case"/meta/disconnect":D(e);break;case"/meta/subscribe":H(e);break;case"/meta/unsubscribe":z(e);break;default:G(e)}}}function Y(e){var t=pt[e];if(t)for(var n=0;n<t.length;++n)if(t[n])return!0;return!1}function et(e,t){var o={scope:e,method:t};if(r(e))o.scope=void 0,o.method=e;else if(n(t)){if(!e)throw"Invalid scope "+e;if(o.method=e[t],!r(o.method))throw"Invalid callback "+t+" for scope "+e}else if(!r(t))throw"Invalid callback "+t;return o}function tt(e,t,n,r){var o=et(t,n);it._debug("Adding",r?"listener":"subscription","on",e,"with scope",o.scope,"and callback",o.method);var i={channel:e,scope:o.scope,callback:o.method,listener:r},s=pt[e];return s||(s=[],pt[e]=s),i.id=s.push(i)-1,it._debug("Added",r?"listener":"subscription",i),i[0]=e,i[1]=i.id,i}var nt,rt,ot,it=this,st=e||"default",ct=!1,at=new org.cometd.TransportRegistry,ut="disconnected",lt=0,ft=null,dt=0,gt=[],ht=!1,pt={},mt=0,vt=null,bt=[],yt={},Tt={},wt=!1,_t=!1,xt={protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",reverseIncomingExtensions:!0,maxNetworkDelay:1e4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,advice:{timeout:6e4,interval:0,reconnect:"retry"}};this._mixin=function(e,n){for(var r=n||{},o=2;o<arguments.length;++o){var i=arguments[o];if(void 0!==i&&null!==i)for(var s in i){var c=t(i,s),a=t(r,s);if(c!==n&&void 0!==c)if(e&&"object"==typeof c&&null!==c)if(c instanceof Array)r[s]=this._mixin(e,a instanceof Array?a:[],c);else{var u="object"!=typeof a||a instanceof Array?{}:a;r[s]=this._mixin(e,u,c)}else r[s]=c}}return r},this._warn=function(){o("warn",arguments)},this._info=function(){"warn"!==xt.logLevel&&o("info",arguments)},this._debug=function(){"debug"===xt.logLevel&&o("debug",arguments)},this._isCrossDomain=function(e){return e&&e!==window.location.host};var kt,St;this.send=T,this.receive=K,kt=function(e){it._debug("Received",e);for(var t=0;t<e.length;++t){var n=e[t];K(n)}},St=function(e,t,n){it._debug("handleFailure",e,t,n),n.transport=e;for(var r=0;r<t.length;++r){var o=t[r],i={id:o.id,successful:!1,channel:o.channel,failure:n};switch(n.message=o,o.channel){case"/meta/handshake":F(i);break;case"/meta/connect":P(i);break;case"/meta/disconnect":M(i);break;case"/meta/subscribe":i.subscription=o.subscription,V(i);break;case"/meta/unsubscribe":i.subscription=o.subscription,X(i);break;default:Q(i)}}},this.registerTransport=function(e,t,n){var o=at.add(e,t,n);return o&&(this._debug("Registered transport",e),r(t.registered)&&t.registered(e,this)),o},this.getTransportTypes=function(){return at.getTransportTypes()},this.unregisterTransport=function(e){var t=at.remove(e);return null!==t&&(this._debug("Unregistered transport",e),r(t.unregistered)&&t.unregistered()),t},this.unregisterTransports=function(){at.clear()},this.findTransport=function(e){return at.find(e)},this.configure=function(e){i.call(this,e)},this.init=function(e,t){this.configure(e),this.handshake(t)},this.handshake=function(e,t){u("disconnected"),wt=!1,U(e,t)},this.disconnect=function(e,t,n){if(!l()){"boolean"!=typeof e&&(n=t,t=e,e=!1),r(t)&&(n=t,t=void 0);var o={channel:"/meta/disconnect",_callback:n},i=this._mixin(!1,{},t,o);u("disconnecting"),y(e===!0,[i],!1,"disconnect")}},this.startBatch=function(){x()},this.endBatch=function(){S()},this.batch=function(e,t){var n=et(e,t);this.startBatch();try{n.method.call(n.scope),this.endBatch()}catch(r){throw this._info("Exception during execution of batch",r),this.endBatch(),r}},this.addListener=function(e,t,r){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!n(e))throw"Illegal argument type: channel must be a string";return tt(e,t,r,!0)},this.removeListener=function(e){if(!(e&&e.channel&&"id"in e))throw"Invalid argument: expected subscription, not "+e;s(e)},this.clearListeners=function(){pt={}},this.subscribe=function(e,t,o,i,s){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!n(e))throw"Illegal argument type: channel must be a string";if(l())throw"Illegal state: already disconnected";r(t)&&(s=i,i=o,o=t,t=void 0),r(i)&&(s=i,i=void 0);var c=!Y(e),a=tt(e,t,o,!1);if(c){var u={channel:"/meta/subscribe",subscription:e,_callback:s},f=this._mixin(!1,{},i,u);T(f)}return a},this.unsubscribe=function(e,t,n){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(l())throw"Illegal state: already disconnected";r(t)&&(n=t,t=void 0),this.removeListener(e);var o=e.channel;if(!Y(o)){var i={channel:"/meta/unsubscribe",subscription:o,_callback:n},s=this._mixin(!1,{},t,i);T(s)}},this.resubscribe=function(e,t){return c(e),e?this.subscribe(e.channel,e.scope,e.callback,t):void 0},this.clearSubscriptions=function(){a()},this.publish=function(e,t,o,i){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!n(e))throw"Illegal argument type: channel must be a string";if(/^\/meta\//.test(e))throw"Illegal argument: cannot publish to meta channels";if(l())throw"Illegal state: already disconnected";r(t)?(i=t,t=o={}):r(o)&&(i=o,o={});var s={channel:e,data:t,_callback:i},c=this._mixin(!1,{},o,s);T(c)},this.getStatus=function(){return ut},this.isDisconnected=l,this.setBackoffIncrement=function(e){xt.backoffIncrement=e},this.getBackoffIncrement=function(){return xt.backoffIncrement},this.getBackoffPeriod=function(){return mt},this.setLogLevel=function(e){xt.logLevel=e},this.registerExtension=function(e,t){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!n(e))throw"Illegal argument type: extension name must be a string";for(var o=!1,i=0;i<bt.length;++i){var s=bt[i];if(s.name===e){o=!0;break}}return o?(this._info("Could not register extension with name",e,"since another extension with the same name already exists"),!1):(bt.push({name:e,extension:t}),this._debug("Registered extension",e),r(t.registered)&&t.registered(e,this),!0)},this.unregisterExtension=function(e){if(!n(e))throw"Illegal argument type: extension name must be a string";for(var t=!1,o=0;o<bt.length;++o){var i=bt[o];if(i.name===e){bt.splice(o,1),t=!0,this._debug("Unregistered extension",e);var s=i.extension;r(s.unregistered)&&s.unregistered();break}}return t},this.getExtension=function(e){for(var t=0;t<bt.length;++t){var n=bt[t];if(n.name===e)return n.extension}return null},this.getName=function(){return st},this.getClientId=function(){return ft},this.getURL=function(){if(nt&&"object"==typeof xt.urls){var e=xt.urls[nt.getType()];if(e)return e}return xt.url},this.getTransport=function(){return nt},this.getConfiguration=function(){return this._mixin(!0,{},xt)},this.getAdvice=function(){return this._mixin(!0,{},yt)},org.cometd.WebSocket=window.WebSocket},org.cometd.Utils={},org.cometd.Utils.isString=function(e){return void 0===e||null===e?!1:"string"==typeof e||e instanceof String},org.cometd.Utils.isArray=function(e){return void 0===e||null===e?!1:e instanceof Array},org.cometd.Utils.inArray=function(e,t){for(var n=0;n<t.length;++n)if(e===t[n])return n;return-1},org.cometd.Utils.setTimeout=function(e,t,n){return window.setTimeout(function(){try{e._debug("Invoking timed function",t),t()}catch(n){e._debug("Exception invoking timed function",t,n)}},n)},org.cometd.Utils.clearTimeout=function(e){window.clearTimeout(e)},org.cometd.JSON={},org.cometd.JSON.toJSON=org.cometd.JSON.fromJSON=function(){throw"Abstract"},org.cometd.Transport=function(){var e,t;this.registered=function(n,r){e=n,t=r},this.unregistered=function(){e=null,t=null},this._debug=function(){t._debug.apply(t,arguments)},this._mixin=function(){return t._mixin.apply(t,arguments)},this.getConfiguration=function(){return t.getConfiguration()},this.getAdvice=function(){return t.getAdvice()},this.setTimeout=function(e,n){return org.cometd.Utils.setTimeout(t,e,n)},this.clearTimeout=function(e){org.cometd.Utils.clearTimeout(e)},this.convertToMessages=function(e){if(org.cometd.Utils.isString(e))try{return org.cometd.JSON.fromJSON(e)}catch(t){throw this._debug("Could not convert to JSON the following string",'"'+e+'"'),t}if(org.cometd.Utils.isArray(e))return e;if(void 0===e||null===e)return[];if(e instanceof Object)return[e];throw"Conversion Error "+e+", typeof "+typeof e},this.accept=function(){throw"Abstract"},this.getType=function(){return e},this.send=function(){throw"Abstract"},this.reset=function(){this._debug("Transport",e,"reset")},this.abort=function(){this._debug("Transport",e,"aborted")},this.toString=function(){return this.getType()}},org.cometd.Transport.derive=function(e){function t(){}return t.prototype=e,new t},org.cometd.RequestTransport=function(){function e(e){for(;f.length>0;){var t=f[0],n=t[0],r=t[1];if(n.url!==e.url||n.sync!==e.sync)break;f.shift(),e.messages=e.messages.concat(n.messages),this._debug("Coalesced",n.messages.length,"messages from request",r.id)}}function t(e,t){if(this.transportSend(e,t),t.expired=!1,!e.sync){var n=this.getConfiguration().maxNetworkDelay,r=n;t.metaConnect===!0&&(r+=this.getAdvice().timeout),this._debug("Transport",this.getType(),"waiting at most",r,"ms for the response, maxNetworkDelay",n);var o=this;t.timeout=this.setTimeout(function(){t.expired=!0;var n="Request "+t.id+" of transport "+o.getType()+" exceeded "+r+" ms max network delay",i={reason:n},s=t.xhr;i.httpCode=o.xhrStatus(s),o.abortXHR(s),o._debug(n),o.complete(t,!1,t.metaConnect),e.onFailure(s,e.messages,i)},r)}}function n(e){var n=++a,r={id:n,metaConnect:!1};l.length<this.getConfiguration().maxConnections-1?(l.push(r),t.call(this,e,r)):(this._debug("Transport",this.getType(),"queueing request",n,"envelope",e),f.push([e,r]))}function r(e){var t=e.id;if(this._debug("Transport",this.getType(),"metaConnect complete, request",t),null!==u&&u.id!==t)throw"Longpoll request mismatch, completing request "+t;u=null}function o(t,r){var o=org.cometd.Utils.inArray(t,l);if(o>=0&&l.splice(o,1),f.length>0){var i=f.shift(),s=i[0],c=i[1];if(this._debug("Transport dequeued request",c.id),r)this.getConfiguration().autoBatch&&e.call(this,s),n.call(this,s),this._debug("Transport completed request",t.id,s);else{var a=this;this.setTimeout(function(){a.complete(c,!1,c.metaConnect);var e={reason:"Previous request failed"},t=c.xhr;e.httpCode=a.xhrStatus(t),s.onFailure(t,s.messages,e)},0)}}}function i(e){if(null!==u)throw"Concurrent metaConnect requests not allowed, request id="+u.id+" not yet completed";var n=++a;this._debug("Transport",this.getType(),"metaConnect send, request",n,"envelope",e);var r={id:n,metaConnect:!0};t.call(this,e,r),u=r}var s=new org.cometd.Transport,c=org.cometd.Transport.derive(s),a=0,u=null,l=[],f=[];return c.complete=function(e,t,n){n?r.call(this,e):o.call(this,e,t)},c.transportSend=function(){throw"Abstract"},c.transportSuccess=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!0,t.metaConnect),n&&n.length>0?e.onSuccess(n):e.onFailure(t.xhr,e.messages,{httpCode:204}))},c.transportFailure=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!1,t.metaConnect),e.onFailure(t.xhr,e.messages,n))},c.send=function(e,t){t?i.call(this,e):n.call(this,e)},c.abort=function(){s.abort();for(var e=0;e<l.length;++e){var t=l[e];this._debug("Aborting request",t),this.abortXHR(t.xhr)}u&&(this._debug("Aborting metaConnect request",u),this.abortXHR(u.xhr)),this.reset()},c.reset=function(){s.reset(),u=null,l=[],f=[]},c.abortXHR=function(e){if(e)try{e.abort()}catch(t){this._debug(t)}},c.xhrStatus=function(e){if(e)try{return e.status}catch(t){this._debug(t)}return-1},c},org.cometd.TransportRegistry=function(){var e=[],t={};this.getTransportTypes=function(){return e.slice(0)},this.findTransportTypes=function(n,r,o){for(var i=[],s=0;s<e.length;++s){var c=e[s];t[c].accept(n,r,o)===!0&&i.push(c)}return i},this.negotiateTransport=function(n,r,o,i){for(var s=0;s<e.length;++s)for(var c=e[s],a=0;a<n.length;++a)if(c===n[a]){var u=t[c];if(u.accept(r,o,i)===!0)return u}return null},this.add=function(n,r,o){for(var i=!1,s=0;s<e.length;++s)if(e[s]===n){i=!0;break}return i||("number"!=typeof o?e.push(n):e.splice(o,0,n),t[n]=r),!i},this.find=function(n){for(var r=0;r<e.length;++r)if(e[r]===n)return t[n];return null},this.remove=function(n){for(var r=0;r<e.length;++r)if(e[r]===n){e.splice(r,1);var o=t[n];return delete t[n],o}return null},this.clear=function(){e=[],t={}},this.reset=function(){for(var n=0;n<e.length;++n)t[e[n]].reset()}},org.cometd.WebSocketTransport=function(){function e(){if(!f){f=!0;var e=r.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",e);try{var t=r.getConfiguration().protocol,n=t?new org.cometd.WebSocket(e,t):new org.cometd.WebSocket(e)}catch(o){throw s=!1,this._debug("Exception while creating WebSocket object",o),o}a=r.getConfiguration().stickyReconnect!==!1;var i=this,c=null,u=r.getConfiguration().connectTimeout;u>0&&(c=this.setTimeout(function(){c=null,i._debug("Transport",i.getType(),"timed out while connecting to URL",e,":",u,"ms");var t={code:1e3,reason:"Connect Timeout"};i.webSocketClose(n,t.code,t.reason),i.onClose(n,t)},u));var l=function(){i._debug("WebSocket opened",n),f=!1,c&&(i.clearTimeout(c),c=null),d?(r._warn("Closing Extra WebSocket Connections",n,d),i.webSocketClose(n,1e3,"Extra Connection")):i.onOpen(n)},g=function(e){e=e||{code:1e3},i._debug("WebSocket closing",n,e),f=!1,c&&(i.clearTimeout(c),c=null),null!==d&&n!==d?i._debug("Closed Extra WebSocket Connection",n):i.onClose(n,e)},h=function(e){i._debug("WebSocket message",e,n),n!==d&&r._warn("Extra WebSocket Connections",n,d),i.onMessage(n,e)};n.onopen=l,n.onclose=g,n.onerror=function(){g({code:1002,reason:"Error"})},n.onmessage=h,this._debug("Transport",this.getType(),"configured callbacks on",n)}}function t(e,t,n){var r=org.cometd.JSON.toJSON(t.messages);e.send(r),this._debug("Transport",this.getType(),"sent",t,"metaConnect =",n);var o=this.getConfiguration().maxNetworkDelay,i=o;n&&(i+=this.getAdvice().timeout,g=!0);for(var s=this,c=[],a=0;a<t.messages.length;++a)!function(){var n=t.messages[a];n.id&&(c.push(n.id),l[n.id]=this.setTimeout(function(){s._debug("Transport",s.getType(),"timing out message",n.id,"after",i,"on",e);var t={code:1e3,reason:"Message Timeout"};s.webSocketClose(e,t.code,t.reason),s.onClose(e,t)},i))}();this._debug("Transport",this.getType(),"waiting at most",i,"ms for messages",c,"maxNetworkDelay",o,", timeouts:",l)}function n(n,r,o){try{null===n?e.call(this):t.call(this,n,r,o)}catch(i){this.setTimeout(function(){r.onFailure(n,r.messages,{exception:i})},0)}}var r,o=new org.cometd.Transport,i=org.cometd.Transport.derive(o),s=!0,c=!1,a=!0,u={},l={},f=!1,d=null,g=!1,h=null;return i.reset=function(){o.reset(),s=!0,c=!1,a=!0,u={},l={},f=!1,d=null,g=!1,h=null},i.onOpen=function(e){this._debug("Transport",this.getType(),"opened",e),d=e,c=!0,this._debug("Sending pending messages",u);for(var n in u){var r=u[n],o=r[0],i=r[1];h=o.onSuccess,t.call(this,e,o,i)}},i.onMessage=function(e,t){this._debug("Transport",this.getType(),"received websocket message",t,e);for(var n=!1,r=this.convertToMessages(t.data),o=[],i=0;i<r.length;++i){var s=r[i];if((/^\/meta\//.test(s.channel)||void 0!==s.successful)&&s.id){o.push(s.id);var c=l[s.id];c&&(this.clearTimeout(c),delete l[s.id],this._debug("Transport",this.getType(),"removed timeout for message",s.id,", timeouts",l))}"/meta/connect"===s.channel&&(g=!1),"/meta/disconnect"!==s.channel||g||(n=!0)}for(var a=!1,f=0;f<o.length;++f){var d=o[f];for(var p in u){var m=p.split(","),v=org.cometd.Utils.inArray(d,m);if(v>=0){a=!0,m.splice(v,1);var b=u[p][0],y=u[p][1];delete u[p],m.length>0&&(u[m.join(",")]=[b,y]);break}}}a&&this._debug("Transport",this.getType(),"removed envelope, envelopes",u),h.call(this,r),n&&this.webSocketClose(e,1e3,"Disconnect")},i.onClose=function(e,t){this._debug("Transport",this.getType(),"closed",e,t),s=a&&c;var n=l;l={};for(var r in n)this.clearTimeout(n[r]);var o=u;u={};for(var i in o){var f=o[i][0],h=o[i][1];h&&(g=!1),f.onFailure(e,f.messages,{websocketCode:t.code,reason:t.reason})}d=null},i.registered=function(e,t){o.registered(e,t),r=t},i.accept=function(){return s&&!!org.cometd.WebSocket&&r.websocketEnabled!==!1},i.send=function(e,t){this._debug("Transport",this.getType(),"sending",e,"metaConnect =",t);for(var r=[],o=0;o<e.messages.length;++o){var i=e.messages[o];i.id&&r.push(i.id)}u[r.join(",")]=[e,t],this._debug("Transport",this.getType(),"stored envelope, envelopes",u),n.call(this,d,e,t)},i.webSocketClose=function(e,t,n){try{e.close(t,n)}catch(r){this._debug(r)}},i.abort=function(){if(o.abort(),d){var e={code:1001,reason:"Abort"};this.webSocketClose(d,e.code,e.reason),this.onClose(d,e)}this.reset()},i},org.cometd.LongPollingTransport=function(){var e=new org.cometd.RequestTransport,t=org.cometd.Transport.derive(e),n=!0;return t.accept=function(e,t){return n||!t},t.xhrSend=function(){throw"Abstract"},t.transportSend=function(e,t){this._debug("Transport",this.getType(),"sending request",t.id,"envelope",e);var r=this;try{var o=!0;t.xhr=this.xhrSend({transport:this,url:e.url,sync:e.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(e.messages),onSuccess:function(o){r._debug("Transport",r.getType(),"received response",o);var i=!1;try{var s=r.convertToMessages(o);0===s.length?(n=!1,r.transportFailure(e,t,{httpCode:204})):(i=!0,r.transportSuccess(e,t,s))}catch(c){if(r._debug(c),!i){n=!1;var a={exception:c};a.httpCode=r.xhrStatus(t.xhr),r.transportFailure(e,t,a)}}},onError:function(i,s){n=!1;var c={reason:i,exception:s};c.httpCode=r.xhrStatus(t.xhr),o?r.setTimeout(function(){r.transportFailure(e,t,c)},0):r.transportFailure(e,t,c)}}),o=!1}catch(i){n=!1,this.setTimeout(function(){r.transportFailure(e,t,{exception:i})},0)}},t.reset=function(){e.reset(),n=!0},t},org.cometd.CallbackPollingTransport=function(){function e(e,t,n){var r=this;return function(){r.transportFailure(e,t,"error",n)}}var t=new org.cometd.RequestTransport,n=org.cometd.Transport.derive(t),r=2e3;return n.accept=function(){return!0},n.jsonpSend=function(){throw"Abstract"},n.transportSend=function(t,n){for(var o=this,i=0,s=t.messages.length,c=[];s>0;){var a=org.cometd.JSON.toJSON(t.messages.slice(i,i+s)),u=t.url.length+encodeURI(a).length;if(u>r){if(1===s){var l="Bayeux message too big ("+u+" bytes, max is "+r+") for transport "+this.getType();return void this.setTimeout(e.call(this,t,n,l),0)}--s}else c.push(s),i+=s,s=t.messages.length-i}var f=t;if(c.length>1){var d=0,g=c[0];this._debug("Transport",this.getType(),"split",t.messages.length,"messages into",c.join(" + ")),f=this._mixin(!1,{},t),f.messages=t.messages.slice(d,g),f.onSuccess=t.onSuccess,f.onFailure=t.onFailure;for(var h=1;h<c.length;++h){var p=this._mixin(!1,{},t);d=g,g+=c[h],p.messages=t.messages.slice(d,g),p.onSuccess=t.onSuccess,p.onFailure=t.onFailure,this.send(p,n.metaConnect)}}this._debug("Transport",this.getType(),"sending request",n.id,"envelope",f);try{var m=!0;this.jsonpSend({transport:this,url:f.url,sync:f.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(f.messages),onSuccess:function(e){var t=!1;try{var r=o.convertToMessages(e);0===r.length?o.transportFailure(f,n,{httpCode:204}):(t=!0,o.transportSuccess(f,n,r))}catch(i){o._debug(i),t||o.transportFailure(f,n,{exception:i})}},onError:function(e,t){var r={reason:e,exception:t};m?o.setTimeout(function(){o.transportFailure(f,n,r)},0):o.transportFailure(f,n,r)
}}),m=!1}catch(v){this.setTimeout(function(){o.transportFailure(f,n,{exception:v})},0)}},n},function(){function e(e,t){function n(e,t){if(t)for(var n in t)"content-type"!==n.toLowerCase()&&e.setRequestHeader(n,t[n])}function r(){var r=new t.LongPollingTransport,o=t.Transport.derive(r);return o.xhrSend=function(t){return e.ajax({url:t.url,async:t.sync!==!0,type:"POST",contentType:"application/json;charset=UTF-8",data:t.body,global:!1,xhrFields:{withCredentials:!0},beforeSend:function(e){return e.withCredentials=!0,n(e,t.headers),!0},success:t.onSuccess,error:function(e,n,r){t.onError(n,r)}})},o}function o(){var r=new t.CallbackPollingTransport,o=t.Transport.derive(r);return o.jsonpSend=function(t){e.ajax({url:t.url,async:t.sync!==!0,type:"GET",dataType:"jsonp",jsonp:"jsonp",data:{message:t.body},beforeSend:function(e){return n(e,t.headers),!0},success:t.onSuccess,error:function(e,n,r){t.onError(n,r)}})},o}return t.JSON.toJSON=JSON.stringify,t.JSON.fromJSON=JSON.parse,e.CometD=function(e){var n=new t.CometD(e);return t.WebSocket&&n.registerTransport("websocket",new t.WebSocketTransport),n.registerTransport("long-polling",new r),n.registerTransport("callback-polling",new o),n},e.cometd=new e.CometD,e.cometd}"function"==typeof define&&define.amd?define(["jquery","org/cometd"],e):e(jQuery,org.cometd)}(),function(){"use strict";function e(){}e.prototype=new EventEmitter;var t,n=new e,r=e.prototype,o=this,i=o.ZetaPush,s=$.cometd,c=null,a=!1,u=[];s.addListener("/meta/connect",function(e){if(s.isDisconnected())return a=!1,void log.info("connection closed");var t=a;a=e.successful,!t&&a?(log.info("connection established"),n.emitEvent("ZetaPush_Connected"),s.batch(function(){n.refresh()})):t&&!a&&(log.warn("connection broken"),n.emitEvent("ZetaPush_Disconnected"))}),s.addListener("/meta/disconnect",function(e){log.info("got disconnect"),e.successful&&(a=!1,log.info("connection closed"),n.emitEvent("ZetaPush_Disconnected"))}),s.addListener("/meta/handshake",function(e){e.successful?(log.debug("successful handshake",e),n.emitEvent("ZetaPush_Hanshake_Successful"),t=e.clientId):(log.warn("unsuccessful handshake"),n.emitEvent("ZetaPush_Hanshake_Denied"),t=null)}),r.init=function(e,t){log.setLevel(t),s.configure({url:e,logLevel:t,backoffIncrement:100,maxBackoff:500,appendMessageTypeToURL:!1})},r.disconnect=function(){s.disconnect(!0)},s.onListenerException=function(e,t,n,r){log.error("Uncaught exception for subscription",t,":",e,"message:",r),n?(s.removeListener(t),log.error("removed listener")):(s.unsubscribe(t),log.error("unsubscribed")),disconnect()},r.subscribe=function(e){return a?(e.sub=s.subscribe(e.chan,e.cb),log.debug("subscribed",e)):log.debug("queuing subscription request",e),u.push(e),null==e.renewOnReconnect&&(e.renewOnReconnect=!0),e},r.unsubscribe=function(e){e.sub&&(s.unsubscribe(e.sub),e.sub=null,log.debug("unsubscribed",e)),e.renewOnReconnect=!1},r.refresh=function(){log.debug("refreshing subscriptions");var e=[];u.forEach(function(t){t.sub&&s.unsubscribe(t.sub),t.renewOnReconnect&&e.push(t)}),u=[],e.forEach(function(e){subscribe(e)})},r.publish=function(e,t){a&&s.publish(e,t)},r.makeResourceId=function(){for(var e="",t="abcdefghijklmnopqrstuvwxyz0123456789",n=0;5>n;n++)e+=t.charAt(Math.floor(Math.random()*t.length));localStorage.resource=e},r.connect=function(e){c=e,s.handshake(e)},r.reconnect=function(){connect(c)},e.noConflict=function(){return o.ZetaPush=i,n},"function"==typeof define&&define.amd?define(function(){return n}):"object"==typeof module&&module.exports?module.exports=n:o.zetaPush=n}.call(this);