!function(e,t){"object"==typeof module&&module.exports&&"function"==typeof require?module.exports=t():"function"==typeof define&&"object"==typeof define.amd?define(t):e.log=t()}(this,function(){function e(e){return typeof console===c?!1:void 0!==console[e]?t(console,e):void 0!==console.log?t(console,"log"):a}function t(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(r){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function n(e,t){return function(){typeof console!==c&&(r(t),s[e].apply(s,arguments))}}function r(e){for(var t=0;t<u.length;t++){var n=u[t];s[n]=e>t?a:s.methodFactory(n,e)}}function i(e){var t=(u[e]||"silent").toUpperCase();try{return void(window.localStorage.loglevel=t)}catch(n){}try{window.document.cookie="loglevel="+t+";"}catch(n){}}function o(){var e;try{e=window.localStorage.loglevel}catch(t){}if(typeof e===c)try{e=/loglevel=([^;]+)/.exec(window.document.cookie)[1]}catch(t){}void 0===s.levels[e]&&(e="WARN"),s.setLevel(s.levels[e])}var s={},a=function(){},c="undefined",u=["trace","debug","info","warn","error"];s.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},s.methodFactory=function(t,r){return e(t)||n(t,r)},s.setLevel=function(e){if("string"==typeof e&&void 0!==s.levels[e.toUpperCase()]&&(e=s.levels[e.toUpperCase()]),!("number"==typeof e&&e>=0&&e<=s.levels.SILENT))throw"log.setLevel() called with invalid level: "+e;return i(e),r(e),typeof console===c&&e<s.levels.SILENT?"No console available for logging":void 0},s.enableAll=function(){s.setLevel(s.levels.TRACE)},s.disableAll=function(){s.setLevel(s.levels.SILENT)};var l=typeof window!==c?window.log:void 0;return s.noConflict=function(){return typeof window!==c&&window.log===s&&(window.log=l),s},o(),s}),function(){"use strict";function e(){}function t(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function n(e){return function(){return this[e].apply(this,arguments)}}var r=e.prototype,i=this,o=i.EventEmitter;r.getListeners=function(e){var t,n,r=this._getEvents();if(e instanceof RegExp){t={};for(n in r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n])}else t=r[e]||(r[e]=[]);return t},r.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},r.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},r.addListener=function(e,n){var r,i=this.getListenersAsObject(e),o="object"==typeof n;for(r in i)i.hasOwnProperty(r)&&-1===t(i[r],n)&&i[r].push(o?n:{listener:n,once:!1});return this},r.on=n("addListener"),r.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},r.once=n("addOnceListener"),r.defineEvent=function(e){return this.getListeners(e),this},r.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},r.removeListener=function(e,n){var r,i,o=this.getListenersAsObject(e);for(i in o)o.hasOwnProperty(i)&&(r=t(o[i],n),-1!==r&&o[i].splice(r,1));return this},r.off=n("removeListener"),r.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},r.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},r.manipulateListeners=function(e,t,n){var r,i,o=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(r=n.length;r--;)o.call(this,t,n[r]);else for(r in t)t.hasOwnProperty(r)&&(i=t[r])&&("function"==typeof i?o.call(this,r,i):s.call(this,r,i));return this},r.removeEvent=function(e){var t,n=typeof e,r=this._getEvents();if("string"===n)delete r[e];else if(e instanceof RegExp)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this},r.removeAllListeners=n("removeEvent"),r.emitEvent=function(e,t){var n,r,i,o,s=this.getListenersAsObject(e);for(i in s)if(s.hasOwnProperty(i))for(r=s[i].length;r--;)n=s[i][r],n.once===!0&&this.removeListener(e,n.listener),o=n.listener.apply(this,t||[]),o===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},r.trigger=n("emitEvent"),r.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},r.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},r._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},r._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return i.EventEmitter=o,e},"function"==typeof define&&define.amd?define(function(){return e}):"object"==typeof module&&module.exports?module.exports=e:i.EventEmitter=e}.call(this);var Zepto=function(){function e(e){return null==e?String(e):W[z.call(e)]||"object"}function t(t){return"function"==e(t)}function n(e){return null!=e&&e==e.window}function r(e){return null!=e&&e.nodeType==e.DOCUMENT_NODE}function i(t){return"object"==e(t)}function o(e){return i(e)&&!n(e)&&Object.getPrototypeOf(e)==Object.prototype}function s(e){return"number"==typeof e.length}function a(e){return j.call(e,function(e){return null!=e})}function c(e){return e.length>0?_.fn.concat.apply([],e):e}function u(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function l(e){return e in R?R[e]:R[e]=new RegExp("(^|\\s)"+e+"(\\s|$)")}function f(e,t){return"number"!=typeof t||A[u(e)]?t:t+"px"}function h(e){var t,n;return N[e]||(t=O.createElement(e),O.body.appendChild(t),n=getComputedStyle(t,"").getPropertyValue("display"),t.parentNode.removeChild(t),"none"==n&&(n="block"),N[e]=n),N[e]}function d(e){return"children"in e?L.call(e.children):_.map(e.childNodes,function(e){return 1==e.nodeType?e:void 0})}function p(e,t,n){for(x in t)n&&(o(t[x])||Y(t[x]))?(o(t[x])&&!o(e[x])&&(e[x]={}),Y(t[x])&&!Y(e[x])&&(e[x]=[]),p(e[x],t[x],n)):t[x]!==T&&(e[x]=t[x])}function g(e,t){return null==t?_(e):_(e).filter(t)}function m(e,n,r,i){return t(n)?n.call(e,r,i):n}function v(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function b(e,t){var n=e.className,r=n&&n.baseVal!==T;return t===T?r?n.baseVal:n:void(r?n.baseVal=t:e.className=t)}function y(e){var t;try{return e?"true"==e||("false"==e?!1:"null"==e?null:/^0/.test(e)||isNaN(t=Number(e))?/^[\[\{]/.test(e)?_.parseJSON(e):e:t):e}catch(n){return e}}function w(e,t){t(e);for(var n=0,r=e.childNodes.length;r>n;n++)w(e.childNodes[n],t)}var T,x,_,S,k,C,E=[],L=E.slice,j=E.filter,O=window.document,N={},R={},A={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},P=/^\s*<(\w+|!)[^>]*>/,U=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,I=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,q=/^(?:body|html)$/i,F=/([A-Z])/g,D=["val","css","html","text","data","width","height","offset"],M=["after","prepend","before","append"],Z=O.createElement("table"),J=O.createElement("tr"),B={tr:O.createElement("tbody"),tbody:Z,thead:Z,tfoot:Z,td:J,th:J,"*":O.createElement("div")},$=/complete|loaded|interactive/,H=/^[\w-]*$/,W={},z=W.toString,V={},X=O.createElement("div"),G={tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},Y=Array.isArray||function(e){return e instanceof Array};return V.matches=function(e,t){if(!t||!e||1!==e.nodeType)return!1;var n=e.webkitMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.matchesSelector;if(n)return n.call(e,t);var r,i=e.parentNode,o=!i;return o&&(i=X).appendChild(e),r=~V.qsa(i,t).indexOf(e),o&&X.removeChild(e),r},k=function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},C=function(e){return j.call(e,function(t,n){return e.indexOf(t)==n})},V.fragment=function(e,t,n){var r,i,s;return U.test(e)&&(r=_(O.createElement(RegExp.$1))),r||(e.replace&&(e=e.replace(I,"<$1></$2>")),t===T&&(t=P.test(e)&&RegExp.$1),t in B||(t="*"),s=B[t],s.innerHTML=""+e,r=_.each(L.call(s.childNodes),function(){s.removeChild(this)})),o(n)&&(i=_(r),_.each(n,function(e,t){D.indexOf(e)>-1?i[e](t):i.attr(e,t)})),r},V.Z=function(e,t){return e=e||[],e.__proto__=_.fn,e.selector=t||"",e},V.isZ=function(e){return e instanceof V.Z},V.init=function(e,n){var r;if(!e)return V.Z();if("string"==typeof e)if(e=e.trim(),"<"==e[0]&&P.test(e))r=V.fragment(e,RegExp.$1,n),e=null;else{if(n!==T)return _(n).find(e);r=V.qsa(O,e)}else{if(t(e))return _(O).ready(e);if(V.isZ(e))return e;if(Y(e))r=a(e);else if(i(e))r=[e],e=null;else if(P.test(e))r=V.fragment(e.trim(),RegExp.$1,n),e=null;else{if(n!==T)return _(n).find(e);r=V.qsa(O,e)}}return V.Z(r,e)},_=function(e,t){return V.init(e,t)},_.extend=function(e){var t,n=L.call(arguments,1);return"boolean"==typeof e&&(t=e,e=n.shift()),n.forEach(function(n){p(e,n,t)}),e},V.qsa=function(e,t){var n,i="#"==t[0],o=!i&&"."==t[0],s=i||o?t.slice(1):t,a=H.test(s);return r(e)&&a&&i?(n=e.getElementById(s))?[n]:[]:1!==e.nodeType&&9!==e.nodeType?[]:L.call(a&&!i?o?e.getElementsByClassName(s):e.getElementsByTagName(t):e.querySelectorAll(t))},_.contains=O.documentElement.contains?function(e,t){return e!==t&&e.contains(t)}:function(e,t){for(;t&&(t=t.parentNode);)if(t===e)return!0;return!1},_.type=e,_.isFunction=t,_.isWindow=n,_.isArray=Y,_.isPlainObject=o,_.isEmptyObject=function(e){var t;for(t in e)return!1;return!0},_.inArray=function(e,t,n){return E.indexOf.call(t,e,n)},_.camelCase=k,_.trim=function(e){return null==e?"":String.prototype.trim.call(e)},_.uuid=0,_.support={},_.expr={},_.map=function(e,t){var n,r,i,o=[];if(s(e))for(r=0;r<e.length;r++)n=t(e[r],r),null!=n&&o.push(n);else for(i in e)n=t(e[i],i),null!=n&&o.push(n);return c(o)},_.each=function(e,t){var n,r;if(s(e)){for(n=0;n<e.length;n++)if(t.call(e[n],n,e[n])===!1)return e}else for(r in e)if(t.call(e[r],r,e[r])===!1)return e;return e},_.grep=function(e,t){return j.call(e,t)},window.JSON&&(_.parseJSON=JSON.parse),_.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){W["[object "+t+"]"]=t.toLowerCase()}),_.fn={forEach:E.forEach,reduce:E.reduce,push:E.push,sort:E.sort,indexOf:E.indexOf,concat:E.concat,map:function(e){return _(_.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return _(L.apply(this,arguments))},ready:function(e){return $.test(O.readyState)&&O.body?e(_):O.addEventListener("DOMContentLoaded",function(){e(_)},!1),this},get:function(e){return e===T?L.call(this):this[e>=0?e:e+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(e){return E.every.call(this,function(t,n){return e.call(t,n,t)!==!1}),this},filter:function(e){return t(e)?this.not(this.not(e)):_(j.call(this,function(t){return V.matches(t,e)}))},add:function(e,t){return _(C(this.concat(_(e,t))))},is:function(e){return this.length>0&&V.matches(this[0],e)},not:function(e){var n=[];if(t(e)&&e.call!==T)this.each(function(t){e.call(this,t)||n.push(this)});else{var r="string"==typeof e?this.filter(e):s(e)&&t(e.item)?L.call(e):_(e);this.forEach(function(e){r.indexOf(e)<0&&n.push(e)})}return _(n)},has:function(e){return this.filter(function(){return i(e)?_.contains(this,e):_(this).find(e).size()})},eq:function(e){return-1===e?this.slice(e):this.slice(e,+e+1)},first:function(){var e=this[0];return e&&!i(e)?e:_(e)},last:function(){var e=this[this.length-1];return e&&!i(e)?e:_(e)},find:function(e){var t,n=this;return t=e?"object"==typeof e?_(e).filter(function(){var e=this;return E.some.call(n,function(t){return _.contains(t,e)})}):1==this.length?_(V.qsa(this[0],e)):this.map(function(){return V.qsa(this,e)}):[]},closest:function(e,t){var n=this[0],i=!1;for("object"==typeof e&&(i=_(e));n&&!(i?i.indexOf(n)>=0:V.matches(n,e));)n=n!==t&&!r(n)&&n.parentNode;return _(n)},parents:function(e){for(var t=[],n=this;n.length>0;)n=_.map(n,function(e){return(e=e.parentNode)&&!r(e)&&t.indexOf(e)<0?(t.push(e),e):void 0});return g(t,e)},parent:function(e){return g(C(this.pluck("parentNode")),e)},children:function(e){return g(this.map(function(){return d(this)}),e)},contents:function(){return this.map(function(){return L.call(this.childNodes)})},siblings:function(e){return g(this.map(function(e,t){return j.call(d(t.parentNode),function(e){return e!==t})}),e)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(e){return _.map(this,function(t){return t[e]})},show:function(){return this.each(function(){"none"==this.style.display&&(this.style.display=""),"none"==getComputedStyle(this,"").getPropertyValue("display")&&(this.style.display=h(this.nodeName))})},replaceWith:function(e){return this.before(e).remove()},wrap:function(e){var n=t(e);if(this[0]&&!n)var r=_(e).get(0),i=r.parentNode||this.length>1;return this.each(function(t){_(this).wrapAll(n?e.call(this,t):i?r.cloneNode(!0):r)})},wrapAll:function(e){if(this[0]){_(this[0]).before(e=_(e));for(var t;(t=e.children()).length;)e=t.first();_(e).append(this)}return this},wrapInner:function(e){var n=t(e);return this.each(function(t){var r=_(this),i=r.contents(),o=n?e.call(this,t):e;i.length?i.wrapAll(o):r.append(o)})},unwrap:function(){return this.parent().each(function(){_(this).replaceWith(_(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(e){return this.each(function(){var t=_(this);(e===T?"none"==t.css("display"):e)?t.show():t.hide()})},prev:function(e){return _(this.pluck("previousElementSibling")).filter(e||"*")},next:function(e){return _(this.pluck("nextElementSibling")).filter(e||"*")},html:function(e){return 0 in arguments?this.each(function(t){var n=this.innerHTML;_(this).empty().append(m(this,e,t,n))}):0 in this?this[0].innerHTML:null},text:function(e){return 0 in arguments?this.each(function(t){var n=m(this,e,t,this.textContent);this.textContent=null==n?"":""+n}):0 in this?this[0].textContent:null},attr:function(e,t){var n;return"string"!=typeof e||1 in arguments?this.each(function(n){if(1===this.nodeType)if(i(e))for(x in e)v(this,x,e[x]);else v(this,e,m(this,t,n,this.getAttribute(e)))}):this.length&&1===this[0].nodeType?!(n=this[0].getAttribute(e))&&e in this[0]?this[0][e]:n:T},removeAttr:function(e){return this.each(function(){1===this.nodeType&&v(this,e)})},prop:function(e,t){return e=G[e]||e,1 in arguments?this.each(function(n){this[e]=m(this,t,n,this[e])}):this[0]&&this[0][e]},data:function(e,t){var n="data-"+e.replace(F,"-$1").toLowerCase(),r=1 in arguments?this.attr(n,t):this.attr(n);return null!==r?y(r):T},val:function(e){return 0 in arguments?this.each(function(t){this.value=m(this,e,t,this.value)}):this[0]&&(this[0].multiple?_(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value)},offset:function(e){if(e)return this.each(function(t){var n=_(this),r=m(this,e,t,n.offset()),i=n.offsetParent().offset(),o={top:r.top-i.top,left:r.left-i.left};"static"==n.css("position")&&(o.position="relative"),n.css(o)});if(!this.length)return null;var t=this[0].getBoundingClientRect();return{left:t.left+window.pageXOffset,top:t.top+window.pageYOffset,width:Math.round(t.width),height:Math.round(t.height)}},css:function(t,n){if(arguments.length<2){var r=this[0],i=getComputedStyle(r,"");if(!r)return;if("string"==typeof t)return r.style[k(t)]||i.getPropertyValue(t);if(Y(t)){var o={};return _.each(Y(t)?t:[t],function(e,t){o[t]=r.style[k(t)]||i.getPropertyValue(t)}),o}}var s="";if("string"==e(t))n||0===n?s=u(t)+":"+f(t,n):this.each(function(){this.style.removeProperty(u(t))});else for(x in t)t[x]||0===t[x]?s+=u(x)+":"+f(x,t[x])+";":this.each(function(){this.style.removeProperty(u(x))});return this.each(function(){this.style.cssText+=";"+s})},index:function(e){return e?this.indexOf(_(e)[0]):this.parent().children().indexOf(this[0])},hasClass:function(e){return e?E.some.call(this,function(e){return this.test(b(e))},l(e)):!1},addClass:function(e){return e?this.each(function(t){S=[];var n=b(this),r=m(this,e,t,n);r.split(/\s+/g).forEach(function(e){_(this).hasClass(e)||S.push(e)},this),S.length&&b(this,n+(n?" ":"")+S.join(" "))}):this},removeClass:function(e){return this.each(function(t){return e===T?b(this,""):(S=b(this),m(this,e,t,S).split(/\s+/g).forEach(function(e){S=S.replace(l(e)," ")}),void b(this,S.trim()))})},toggleClass:function(e,t){return e?this.each(function(n){var r=_(this),i=m(this,e,n,b(this));i.split(/\s+/g).forEach(function(e){(t===T?!r.hasClass(e):t)?r.addClass(e):r.removeClass(e)})}):this},scrollTop:function(e){if(this.length){var t="scrollTop"in this[0];return e===T?t?this[0].scrollTop:this[0].pageYOffset:this.each(t?function(){this.scrollTop=e}:function(){this.scrollTo(this.scrollX,e)})}},scrollLeft:function(e){if(this.length){var t="scrollLeft"in this[0];return e===T?t?this[0].scrollLeft:this[0].pageXOffset:this.each(t?function(){this.scrollLeft=e}:function(){this.scrollTo(e,this.scrollY)})}},position:function(){if(this.length){var e=this[0],t=this.offsetParent(),n=this.offset(),r=q.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(_(e).css("margin-top"))||0,n.left-=parseFloat(_(e).css("margin-left"))||0,r.top+=parseFloat(_(t[0]).css("border-top-width"))||0,r.left+=parseFloat(_(t[0]).css("border-left-width"))||0,{top:n.top-r.top,left:n.left-r.left}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||O.body;e&&!q.test(e.nodeName)&&"static"==_(e).css("position");)e=e.offsetParent;return e})}},_.fn.detach=_.fn.remove,["width","height"].forEach(function(e){var t=e.replace(/./,function(e){return e[0].toUpperCase()});_.fn[e]=function(i){var o,s=this[0];return i===T?n(s)?s["inner"+t]:r(s)?s.documentElement["scroll"+t]:(o=this.offset())&&o[e]:this.each(function(t){s=_(this),s.css(e,m(this,i,t,s[e]()))})}}),M.forEach(function(t,n){var r=n%2;_.fn[t]=function(){var t,i,o=_.map(arguments,function(n){return t=e(n),"object"==t||"array"==t||null==n?n:V.fragment(n)}),s=this.length>1;return o.length<1?this:this.each(function(e,t){i=r?t:t.parentNode,t=0==n?t.nextSibling:1==n?t.firstChild:2==n?t:null;var a=_.contains(O.documentElement,i);o.forEach(function(e){if(s)e=e.cloneNode(!0);else if(!i)return _(e).remove();i.insertBefore(e,t),a&&w(e,function(e){null==e.nodeName||"SCRIPT"!==e.nodeName.toUpperCase()||e.type&&"text/javascript"!==e.type||e.src||window.eval.call(window,e.innerHTML)})})})},_.fn[r?t+"To":"insert"+(n?"Before":"After")]=function(e){return _(e)[t](this),this}}),V.Z.prototype=_.fn,V.uniq=C,V.deserializeValue=y,_.zepto=V,_}();window.Zepto=Zepto,void 0===window.$&&(window.$=Zepto),function(e){function t(e){return e._zid||(e._zid=h++)}function n(e,n,o,s){if(n=r(n),n.ns)var a=i(n.ns);return(m[t(e)]||[]).filter(function(e){return!(!e||n.e&&e.e!=n.e||n.ns&&!a.test(e.ns)||o&&t(e.fn)!==t(o)||s&&e.sel!=s)})}function r(e){var t=(""+e).split(".");return{e:t[0],ns:t.slice(1).sort().join(" ")}}function i(e){return new RegExp("(?:^| )"+e.replace(" "," .* ?")+"(?: |$)")}function o(e,t){return e.del&&!b&&e.e in y||!!t}function s(e){return w[e]||b&&y[e]||e}function a(n,i,a,c,l,h,d){var p=t(n),g=m[p]||(m[p]=[]);i.split(/\s/).forEach(function(t){if("ready"==t)return e(document).ready(a);var i=r(t);i.fn=a,i.sel=l,i.e in w&&(a=function(t){var n=t.relatedTarget;return!n||n!==this&&!e.contains(this,n)?i.fn.apply(this,arguments):void 0}),i.del=h;var p=h||a;i.proxy=function(e){if(e=u(e),!e.isImmediatePropagationStopped()){e.data=c;var t=p.apply(n,e._args==f?[e]:[e].concat(e._args));return t===!1&&(e.preventDefault(),e.stopPropagation()),t}},i.i=g.length,g.push(i),"addEventListener"in n&&n.addEventListener(s(i.e),i.proxy,o(i,d))})}function c(e,r,i,a,c){var u=t(e);(r||"").split(/\s/).forEach(function(t){n(e,t,i,a).forEach(function(t){delete m[u][t.i],"removeEventListener"in e&&e.removeEventListener(s(t.e),t.proxy,o(t,c))})})}function u(t,n){return(n||!t.isDefaultPrevented)&&(n||(n=t),e.each(S,function(e,r){var i=n[e];t[e]=function(){return this[r]=T,i&&i.apply(n,arguments)},t[r]=x}),(n.defaultPrevented!==f?n.defaultPrevented:"returnValue"in n?n.returnValue===!1:n.getPreventDefault&&n.getPreventDefault())&&(t.isDefaultPrevented=T)),t}function l(e){var t,n={originalEvent:e};for(t in e)_.test(t)||e[t]===f||(n[t]=e[t]);return u(n,e)}var f,h=1,d=Array.prototype.slice,p=e.isFunction,g=function(e){return"string"==typeof e},m={},v={},b="onfocusin"in window,y={focus:"focusin",blur:"focusout"},w={mouseenter:"mouseover",mouseleave:"mouseout"};v.click=v.mousedown=v.mouseup=v.mousemove="MouseEvents",e.event={add:a,remove:c},e.proxy=function(n,r){var i=2 in arguments&&d.call(arguments,2);if(p(n)){var o=function(){return n.apply(r,i?i.concat(d.call(arguments)):arguments)};return o._zid=t(n),o}if(g(r))return i?(i.unshift(n[r],n),e.proxy.apply(null,i)):e.proxy(n[r],n);throw new TypeError("expected function")},e.fn.bind=function(e,t,n){return this.on(e,t,n)},e.fn.unbind=function(e,t){return this.off(e,t)},e.fn.one=function(e,t,n,r){return this.on(e,t,n,r,1)};var T=function(){return!0},x=function(){return!1},_=/^([A-Z]|returnValue$|layer[XY]$)/,S={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};e.fn.delegate=function(e,t,n){return this.on(t,e,n)},e.fn.undelegate=function(e,t,n){return this.off(t,e,n)},e.fn.live=function(t,n){return e(document.body).delegate(this.selector,t,n),this},e.fn.die=function(t,n){return e(document.body).undelegate(this.selector,t,n),this},e.fn.on=function(t,n,r,i,o){var s,u,h=this;return t&&!g(t)?(e.each(t,function(e,t){h.on(e,n,r,t,o)}),h):(g(n)||p(i)||i===!1||(i=r,r=n,n=f),(p(r)||r===!1)&&(i=r,r=f),i===!1&&(i=x),h.each(function(f,h){o&&(s=function(e){return c(h,e.type,i),i.apply(this,arguments)}),n&&(u=function(t){var r,o=e(t.target).closest(n,h).get(0);return o&&o!==h?(r=e.extend(l(t),{currentTarget:o,liveFired:h}),(s||i).apply(o,[r].concat(d.call(arguments,1)))):void 0}),a(h,t,i,r,n,u||s)}))},e.fn.off=function(t,n,r){var i=this;return t&&!g(t)?(e.each(t,function(e,t){i.off(e,n,t)}),i):(g(n)||p(r)||r===!1||(r=n,n=f),r===!1&&(r=x),i.each(function(){c(this,t,r,n)}))},e.fn.trigger=function(t,n){return t=g(t)||e.isPlainObject(t)?e.Event(t):u(t),t._args=n,this.each(function(){"dispatchEvent"in this?this.dispatchEvent(t):e(this).triggerHandler(t,n)})},e.fn.triggerHandler=function(t,r){var i,o;return this.each(function(s,a){i=l(g(t)?e.Event(t):t),i._args=r,i.target=a,e.each(n(a,t.type||t),function(e,t){return o=t.proxy(i),i.isImmediatePropagationStopped()?!1:void 0})}),o},"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(t){e.fn[t]=function(e){return e?this.bind(t,e):this.trigger(t)}}),["focus","blur"].forEach(function(t){e.fn[t]=function(e){return e?this.bind(t,e):this.each(function(){try{this[t]()}catch(e){}}),this}}),e.Event=function(e,t){g(e)||(t=e,e=t.type);var n=document.createEvent(v[e]||"Events"),r=!0;if(t)for(var i in t)"bubbles"==i?r=!!t[i]:n[i]=t[i];return n.initEvent(e,r,!0),u(n)}}(Zepto),function(e){function t(t,n,r){var i=e.Event(n);return e(t).trigger(i,r),!i.isDefaultPrevented()}function n(e,n,r,i){return e.global?t(n||b,r,i):void 0}function r(t){t.global&&0===e.active++&&n(t,null,"ajaxStart")}function i(t){t.global&&!--e.active&&n(t,null,"ajaxStop")}function o(e,t){var r=t.context;return t.beforeSend.call(r,e,t)===!1||n(t,r,"ajaxBeforeSend",[e,t])===!1?!1:void n(t,r,"ajaxSend",[e,t])}function s(e,t,r,i){var o=r.context,s="success";r.success.call(o,e,s,t),i&&i.resolveWith(o,[e,s,t]),n(r,o,"ajaxSuccess",[t,r,e]),c(s,t,r)}function a(e,t,r,i,o){var s=i.context;i.error.call(s,r,t,e),o&&o.rejectWith(s,[r,t,e]),n(i,s,"ajaxError",[r,i,e||t]),c(t,r,i)}function c(e,t,r){var o=r.context;r.complete.call(o,t,e),n(r,o,"ajaxComplete",[t,r]),i(r)}function u(){}function l(e){return e&&(e=e.split(";",2)[0]),e&&(e==_?"html":e==x?"json":w.test(e)?"script":T.test(e)&&"xml")||"text"}function f(e,t){return""==t?e:(e+"&"+t).replace(/[&?]{1,2}/,"?")}function h(t){t.processData&&t.data&&"string"!=e.type(t.data)&&(t.data=e.param(t.data,t.traditional)),!t.data||t.type&&"GET"!=t.type.toUpperCase()||(t.url=f(t.url,t.data),t.data=void 0)}function d(t,n,r,i){return e.isFunction(n)&&(i=r,r=n,n=void 0),e.isFunction(r)||(i=r,r=void 0),{url:t,data:n,success:r,dataType:i}}function p(t,n,r,i){var o,s=e.isArray(n),a=e.isPlainObject(n);e.each(n,function(n,c){o=e.type(c),i&&(n=r?i:i+"["+(a||"object"==o||"array"==o?n:"")+"]"),!i&&s?t.add(c.name,c.value):"array"==o||!r&&"object"==o?p(t,c,r,n):t.add(n,c)})}var g,m,v=0,b=window.document,y=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,w=/^(?:text|application)\/javascript/i,T=/^(?:text|application)\/xml/i,x="application/json",_="text/html",S=/^\s*$/;e.active=0,e.ajaxJSONP=function(t,n){if(!("type"in t))return e.ajax(t);var r,i,c=t.jsonpCallback,u=(e.isFunction(c)?c():c)||"jsonp"+ ++v,l=b.createElement("script"),f=window[u],h=function(t){e(l).triggerHandler("error",t||"abort")},d={abort:h};return n&&n.promise(d),e(l).on("load error",function(o,c){clearTimeout(i),e(l).off().remove(),"error"!=o.type&&r?s(r[0],d,t,n):a(null,c||"error",d,t,n),window[u]=f,r&&e.isFunction(f)&&f(r[0]),f=r=void 0}),o(d,t)===!1?(h("abort"),d):(window[u]=function(){r=arguments},l.src=t.url.replace(/\?(.+)=\?/,"?$1="+u),b.head.appendChild(l),t.timeout>0&&(i=setTimeout(function(){h("timeout")},t.timeout)),d)},e.ajaxSettings={type:"GET",beforeSend:u,success:u,error:u,complete:u,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:x,xml:"application/xml, text/xml",html:_,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},e.ajax=function(t){var n=e.extend({},t||{}),i=e.Deferred&&e.Deferred();for(g in e.ajaxSettings)void 0===n[g]&&(n[g]=e.ajaxSettings[g]);r(n),n.crossDomain||(n.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(n.url)&&RegExp.$2!=window.location.host),n.url||(n.url=window.location.toString()),h(n);var c=n.dataType,d=/\?.+=\?/.test(n.url);if(d&&(c="jsonp"),n.cache!==!1&&(t&&t.cache===!0||"script"!=c&&"jsonp"!=c)||(n.url=f(n.url,"_="+Date.now())),"jsonp"==c)return d||(n.url=f(n.url,n.jsonp?n.jsonp+"=?":n.jsonp===!1?"":"callback=?")),e.ajaxJSONP(n,i);var p,v=n.accepts[c],b={},y=function(e,t){b[e.toLowerCase()]=[e,t]},w=/^([\w-]+:)\/\//.test(n.url)?RegExp.$1:window.location.protocol,T=n.xhr(),x=T.setRequestHeader;if(i&&i.promise(T),n.crossDomain||y("X-Requested-With","XMLHttpRequest"),y("Accept",v||"*/*"),(v=n.mimeType||v)&&(v.indexOf(",")>-1&&(v=v.split(",",2)[0]),T.overrideMimeType&&T.overrideMimeType(v)),(n.contentType||n.contentType!==!1&&n.data&&"GET"!=n.type.toUpperCase())&&y("Content-Type",n.contentType||"application/x-www-form-urlencoded"),n.headers)for(m in n.headers)y(m,n.headers[m]);if(T.setRequestHeader=y,T.onreadystatechange=function(){if(4==T.readyState){T.onreadystatechange=u,clearTimeout(p);var t,r=!1;if(T.status>=200&&T.status<300||304==T.status||0==T.status&&"file:"==w){c=c||l(n.mimeType||T.getResponseHeader("content-type")),t=T.responseText;try{"script"==c?(1,eval)(t):"xml"==c?t=T.responseXML:"json"==c&&(t=S.test(t)?null:e.parseJSON(t))}catch(o){r=o}r?a(r,"parsererror",T,n,i):s(t,T,n,i)}else a(T.statusText||null,T.status?"error":"abort",T,n,i)}},o(T,n)===!1)return T.abort(),a(null,"abort",T,n,i),T;if(n.xhrFields)for(m in n.xhrFields)T[m]=n.xhrFields[m];var _="async"in n?n.async:!0;T.open(n.type,n.url,_,n.username,n.password);for(m in b)x.apply(T,b[m]);return n.timeout>0&&(p=setTimeout(function(){T.onreadystatechange=u,T.abort(),a(null,"timeout",T,n,i)},n.timeout)),T.send(n.data?n.data:null),T},e.get=function(){return e.ajax(d.apply(null,arguments))},e.post=function(){var t=d.apply(null,arguments);return t.type="POST",e.ajax(t)},e.getJSON=function(){var t=d.apply(null,arguments);return t.dataType="json",e.ajax(t)},e.fn.load=function(t,n,r){if(!this.length)return this;var i,o=this,s=t.split(/\s/),a=d(t,n,r),c=a.success;return s.length>1&&(a.url=s[0],i=s[1]),a.success=function(t){o.html(i?e("<div>").html(t.replace(y,"")).find(i):t),c&&c.apply(o,arguments)},e.ajax(a),this};var k=encodeURIComponent;e.param=function(e,t){var n=[];return n.add=function(e,t){this.push(k(e)+"="+k(t))},p(n,e,t),n.join("&").replace(/%20/g,"+")}}(Zepto),function(e){e.fn.serializeArray=function(){var t,n=[];return e([].slice.call(this.get(0).elements)).each(function(){t=e(this);var r=t.attr("type");"fieldset"!=this.nodeName.toLowerCase()&&!this.disabled&&"submit"!=r&&"reset"!=r&&"button"!=r&&("radio"!=r&&"checkbox"!=r||this.checked)&&n.push({name:t.attr("name"),value:t.val()})}),n},e.fn.serialize=function(){var e=[];return this.serializeArray().forEach(function(t){e.push(encodeURIComponent(t.name)+"="+encodeURIComponent(t.value))}),e.join("&")},e.fn.submit=function(t){if(t)this.bind("submit",t);else if(this.length){var n=e.Event("submit");this.eq(0).trigger(n),n.isDefaultPrevented()||this.get(0).submit()}return this}}(Zepto),function(e){"__proto__"in{}||e.extend(e.zepto,{Z:function(t,n){return t=t||[],e.extend(t,e.fn),t.selector=n||"",t.__Z=!0,t},isZ:function(t){return"array"===e.type(t)&&"__Z"in t}});try{getComputedStyle(void 0)}catch(t){var n=getComputedStyle;window.getComputedStyle=function(e){try{return n(e)}catch(t){return null}}}}(Zepto);var jQuery=Zepto;this.org=this.org||{},org.cometd={},org.cometd.CometD=function(e){function t(e,t){try{return e[t]}catch(n){return void 0}}function n(e){return org.cometd.Utils.isString(e)}function r(e){return void 0===e||null===e?!1:"function"==typeof e}function i(e,t){if(window.console){var n=window.console[e];r(n)&&n.apply(window.console,t)}}function o(e){ot._debug("Configuring cometd object with",e),n(e)&&(e={url:e}),e||(e={}),_t=ot._mixin(!1,_t,e);var t=ot.getURL();if(!t)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";var r=/(^https?:\/\/)?(((\[[^\]]+\])|([^:\/\?#]+))(:(\d+))?)?([^\?#]*)(.*)?/.exec(t),i=r[2],o=r[8],s=r[9];if(at=ot._isCrossDomain(i),_t.appendMessageTypeToURL)if(void 0!==s&&s.length>0)ot._info("Appending message type to URI "+o+s+" is not supported, disabling 'appendMessageTypeToURL' configuration"),_t.appendMessageTypeToURL=!1;else{var a=o.split("/"),c=a.length-1;o.match(/\/$/)&&(c-=1),a[c].indexOf(".")>=0&&(ot._info("Appending message type to URI "+o+" is not supported, disabling 'appendMessageTypeToURL' configuration"),_t.appendMessageTypeToURL=!1)}}function s(e){if(e){var t=gt[e.channel];t&&t[e.id]&&(delete t[e.id],ot._debug("Removed",e.listener?"listener":"subscription",e))}}function a(e){e&&!e.listener&&s(e)}function c(){for(var e in gt){var t=gt[e];if(t)for(var n=0;n<t.length;++n)a(t[n])}}function u(e){ut!==e&&(ot._debug("Status",ut,"->",e),ut=e)}function l(){return"disconnecting"===ut||"disconnected"===ut}function f(){return++lt}function h(e,t,n,i,o){try{return t.call(e,i)}catch(s){ot._debug("Exception during execution of extension",n,s);var a=ot.onExtensionException;if(r(a)){ot._debug("Invoking extension exception callback",n,s);try{a.call(ot,s,n,o,i)}catch(c){ot._info("Exception during execution of exception callback in extension",n,c)}}return i}}function d(e){for(var t=0;t<bt.length&&(void 0!==e&&null!==e);++t){var n=_t.reverseIncomingExtensions?bt.length-1-t:t,i=bt[n],o=i.extension.incoming;if(r(o)){var s=h(i.extension,o,i.name,e,!1);e=void 0===s?e:s}}return e}function p(e){for(var t=0;t<bt.length&&(void 0!==e&&null!==e);++t){var n=bt[t],i=n.extension.outgoing;if(r(i)){var o=h(n.extension,i,n.name,e,!0);e=void 0===o?e:o}}return e}function g(e,t){var n=gt[e];if(n&&n.length>0)for(var i=0;i<n.length;++i){var o=n[i];if(o)try{o.callback.call(o.scope,t)}catch(s){ot._debug("Exception during notification",o,t,s);var a=ot.onListenerException;if(r(a)){ot._debug("Invoking listener exception callback",o,s);
try{a.call(ot,s,o,o.listener,t)}catch(c){ot._info("Exception during execution of listener callback",o,c)}}}}}function m(e,t){g(e,t);for(var n=e.split("/"),r=n.length-1,i=r;i>0;--i){var o=n.slice(0,i).join("/")+"/*";i===r&&g(o,t),o+="*",g(o,t)}}function v(){null!==vt&&org.cometd.Utils.clearTimeout(vt),vt=null}function b(e){v();var t=yt.interval+mt;ot._debug("Function scheduled in",t,"ms, interval =",yt.interval,"backoff =",mt,e),vt=org.cometd.Utils.setTimeout(ot,e,t)}function y(e,t,n,i){for(var o=0;o<t.length;++o){var s=t[o],a=""+f();s.id=a,ft&&(s.clientId=ft);var c=void 0;r(s._callback)&&(c=s._callback,delete s._callback),s=p(s),void 0!==s&&null!==s?(s.id=a,t[o]=s,c&&(wt[a]=c)):t.splice(o--,1)}if(0!==t.length){var u=ot.getURL();_t.appendMessageTypeToURL&&(u.match(/\/$/)||(u+="/"),i&&(u+=i));var l={url:u,sync:e,messages:t,onSuccess:function(e){try{St.call(ot,e)}catch(t){ot._debug("Exception during handling of messages",t)}},onFailure:function(e,t,n){try{var r=ot.getTransport();n.connectionType=r?r.getType():"unknown",kt.call(ot,e,t,n)}catch(i){ot._debug("Exception during handling of failure",i)}}};ot._debug("Send",l),nt.send(l,n)}}function w(e){ht>0||pt===!0?dt.push(e):y(!1,[e],!1)}function T(){mt=0}function x(){mt<_t.maxBackoff&&(mt+=_t.backoffIncrement)}function _(){++ht}function S(){var e=dt;dt=[],e.length>0&&y(!1,e,!1)}function k(){if(--ht,0>ht)throw"Calls to startBatch() and endBatch() are not paired";0!==ht||l()||pt||S()}function C(){if(!l()){var e={channel:"/meta/connect",connectionType:nt.getType()};xt||(e.advice={timeout:0}),u("connecting"),ot._debug("Connect sent",e),y(!1,[e],!0,"connect"),u("connected")}}function E(){u("connecting"),b(function(){C()})}function L(e){e&&(yt=ot._mixin(!1,{},_t.advice,e),ot._debug("New advice",yt))}function j(e){if(v(),e&&nt&&nt.abort(),ft=null,u("disconnected"),ht=0,T(),nt=null,dt.length>0){var t=dt;dt=[],kt.call(ot,void 0,t,{reason:"Disconnected"})}}function O(e,t,n){var i=ot.onTransportFailure;if(r(i)){ot._debug("Invoking transport failure callback",e,t,n);try{i.call(ot,e,t,n)}catch(o){ot._info("Exception during execution of transport failure callback",o)}}}function N(e,t){r(e)&&(t=e,e=void 0),ft=null,c(),l()?(ct.reset(),L(_t.advice)):L(ot._mixin(!1,yt,{reconnect:"retry"})),ht=0,pt=!0,rt=e,it=t;var n="1.0",i=ot.getURL(),o=ct.findTransportTypes(n,at,i),s={version:n,minimumVersion:n,channel:"/meta/handshake",supportedConnectionTypes:o,_callback:t,advice:{timeout:yt.timeout,interval:yt.interval}},a=ot._mixin(!1,{},rt,s);if(!nt&&(nt=ct.negotiateTransport(o,n,at,i),!nt)){var f="Could not find initial transport among: "+ct.getTransportTypes();throw ot._warn(f),f}ot._debug("Initial transport is",nt.getType()),u("handshaking"),ot._debug("Handshake sent",a),y(!1,[a],!1,"handshake")}function R(){u("handshaking"),pt=!0,b(function(){N(rt,it)})}function A(e){var t=wt[e.id];r(t)&&(delete wt[e.id],t.call(ot,e))}function P(e){A(e),m("/meta/handshake",e),m("/meta/unsuccessful",e);var t=!l()&&"none"!==yt.reconnect;t?(x(),R()):j(!1)}function U(e){if(e.successful){ft=e.clientId;var t=ot.getURL(),n=ct.negotiateTransport(e.supportedConnectionTypes,e.version,at,t);if(null===n){var r="Could not negotiate transport with server; client=["+ct.findTransportTypes(e.version,at,t)+"], server=["+e.supportedConnectionTypes+"]",i=ot.getTransport();return O(i.getType(),null,{reason:r,connectionType:i.getType(),transport:i}),ot._warn(r),void j(!0)}nt!==n&&(ot._debug("Transport",nt.getType(),"->",n.getType()),nt=n),pt=!1,S(),e.reestablish=Tt,Tt=!0,A(e),m("/meta/handshake",e);var o=l()?"none":yt.reconnect;switch(o){case"retry":T(),E();break;case"none":j(!1);break;default:throw"Unrecognized advice action "+o}}else P(e)}function I(e){var t="1.0",n=ot.getURL(),r=ot.getTransport(),i=ct.findTransportTypes(t,at,n),o=ct.negotiateTransport(i,t,at,n);o?(ot._debug("Transport",r.getType(),"->",o.getType()),O(r.getType(),o.getType(),e.failure),P(e),nt=o):(O(r.getType(),null,e.failure),ot._warn("Could not negotiate transport; client=["+i+"]"),j(!0),P(e))}function q(e){m("/meta/connect",e),m("/meta/unsuccessful",e);var t=l()?"none":yt.reconnect;switch(t){case"retry":E(),x();break;case"handshake":ct.reset(),T(),R();break;case"none":j(!1);break;default:throw"Unrecognized advice action"+t}}function F(e){if(xt=e.successful){m("/meta/connect",e);var t=l()?"none":yt.reconnect;switch(t){case"retry":T(),E();break;case"none":j(!1);break;default:throw"Unrecognized advice action "+t}}else q(e)}function D(e){xt=!1,q(e)}function M(e){j(!0),A(e),m("/meta/disconnect",e),m("/meta/unsuccessful",e)}function Z(e){e.successful?(j(!1),A(e),m("/meta/disconnect",e)):M(e)}function J(e){M(e)}function B(e){var t=gt[e.subscription];if(t)for(var n=t.length-1;n>=0;--n){var r=t[n];if(r&&!r.listener){delete t[n],ot._debug("Removed failed subscription",r);break}}A(e),m("/meta/subscribe",e),m("/meta/unsuccessful",e)}function $(e){e.successful?(A(e),m("/meta/subscribe",e)):B(e)}function H(e){B(e)}function W(e){A(e),m("/meta/unsubscribe",e),m("/meta/unsuccessful",e)}function z(e){e.successful?(A(e),m("/meta/unsubscribe",e)):W(e)}function V(e){W(e)}function X(e){A(e),m("/meta/publish",e),m("/meta/unsuccessful",e)}function G(e){void 0===e.successful?void 0!==e.data?m(e.channel,e):ot._warn("Unknown Bayeux Message",e):e.successful?(A(e),m("/meta/publish",e)):X(e)}function Y(e){X(e)}function Q(e){if(e=d(e),void 0!==e&&null!==e){L(e.advice);var t=e.channel;switch(t){case"/meta/handshake":U(e);break;case"/meta/connect":F(e);break;case"/meta/disconnect":Z(e);break;case"/meta/subscribe":$(e);break;case"/meta/unsubscribe":z(e);break;default:G(e)}}}function K(e){var t=gt[e];if(t)for(var n=0;n<t.length;++n)if(t[n])return!0;return!1}function et(e,t){var i={scope:e,method:t};if(r(e))i.scope=void 0,i.method=e;else if(n(t)){if(!e)throw"Invalid scope "+e;if(i.method=e[t],!r(i.method))throw"Invalid callback "+t+" for scope "+e}else if(!r(t))throw"Invalid callback "+t;return i}function tt(e,t,n,r){var i=et(t,n);ot._debug("Adding",r?"listener":"subscription","on",e,"with scope",i.scope,"and callback",i.method);var o={channel:e,scope:i.scope,callback:i.method,listener:r},s=gt[e];return s||(s=[],gt[e]=s),o.id=s.push(o)-1,ot._debug("Added",r?"listener":"subscription",o),o[0]=e,o[1]=o.id,o}var nt,rt,it,ot=this,st=e||"default",at=!1,ct=new org.cometd.TransportRegistry,ut="disconnected",lt=0,ft=null,ht=0,dt=[],pt=!1,gt={},mt=0,vt=null,bt=[],yt={},wt={},Tt=!1,xt=!1,_t={protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",reverseIncomingExtensions:!0,maxNetworkDelay:1e4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,advice:{timeout:6e4,interval:0,reconnect:"retry"}};this._mixin=function(e,n){for(var r=n||{},i=2;i<arguments.length;++i){var o=arguments[i];if(void 0!==o&&null!==o)for(var s in o){var a=t(o,s),c=t(r,s);if(a!==n&&void 0!==a)if(e&&"object"==typeof a&&null!==a)if(a instanceof Array)r[s]=this._mixin(e,c instanceof Array?c:[],a);else{var u="object"!=typeof c||c instanceof Array?{}:c;r[s]=this._mixin(e,u,a)}else r[s]=a}}return r},this._warn=function(){i("warn",arguments)},this._info=function(){"warn"!==_t.logLevel&&i("info",arguments)},this._debug=function(){"debug"===_t.logLevel&&i("debug",arguments)},this._isCrossDomain=function(e){return e&&e!==window.location.host};var St,kt;this.send=w,this.receive=Q,St=function(e){ot._debug("Received",e);for(var t=0;t<e.length;++t){var n=e[t];Q(n)}},kt=function(e,t,n){ot._debug("handleFailure",e,t,n),n.transport=e;for(var r=0;r<t.length;++r){var i=t[r],o={id:i.id,successful:!1,channel:i.channel,failure:n};switch(n.message=i,i.channel){case"/meta/handshake":I(o);break;case"/meta/connect":D(o);break;case"/meta/disconnect":J(o);break;case"/meta/subscribe":o.subscription=i.subscription,H(o);break;case"/meta/unsubscribe":o.subscription=i.subscription,V(o);break;default:Y(o)}}},this.registerTransport=function(e,t,n){var i=ct.add(e,t,n);return i&&(this._debug("Registered transport",e),r(t.registered)&&t.registered(e,this)),i},this.getTransportTypes=function(){return ct.getTransportTypes()},this.unregisterTransport=function(e){var t=ct.remove(e);return null!==t&&(this._debug("Unregistered transport",e),r(t.unregistered)&&t.unregistered()),t},this.unregisterTransports=function(){ct.clear()},this.findTransport=function(e){return ct.find(e)},this.configure=function(e){o.call(this,e)},this.init=function(e,t){this.configure(e),this.handshake(t)},this.handshake=function(e,t){u("disconnected"),Tt=!1,N(e,t)},this.disconnect=function(e,t,n){if(!l()){"boolean"!=typeof e&&(n=t,t=e,e=!1),r(t)&&(n=t,t=void 0);var i={channel:"/meta/disconnect",_callback:n},o=this._mixin(!1,{},t,i);u("disconnecting"),y(e===!0,[o],!1,"disconnect")}},this.startBatch=function(){_()},this.endBatch=function(){k()},this.batch=function(e,t){var n=et(e,t);this.startBatch();try{n.method.call(n.scope),this.endBatch()}catch(r){throw this._info("Exception during execution of batch",r),this.endBatch(),r}},this.addListener=function(e,t,r){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!n(e))throw"Illegal argument type: channel must be a string";return tt(e,t,r,!0)},this.removeListener=function(e){if(!(e&&e.channel&&"id"in e))throw"Invalid argument: expected subscription, not "+e;s(e)},this.clearListeners=function(){gt={}},this.subscribe=function(e,t,i,o,s){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!n(e))throw"Illegal argument type: channel must be a string";if(l())throw"Illegal state: already disconnected";r(t)&&(s=o,o=i,i=t,t=void 0),r(o)&&(s=o,o=void 0);var a=!K(e),c=tt(e,t,i,!1);if(a){var u={channel:"/meta/subscribe",subscription:e,_callback:s},f=this._mixin(!1,{},o,u);w(f)}return c},this.unsubscribe=function(e,t,n){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(l())throw"Illegal state: already disconnected";r(t)&&(n=t,t=void 0),this.removeListener(e);var i=e.channel;if(!K(i)){var o={channel:"/meta/unsubscribe",subscription:i,_callback:n},s=this._mixin(!1,{},t,o);w(s)}},this.resubscribe=function(e,t){return a(e),e?this.subscribe(e.channel,e.scope,e.callback,t):void 0},this.clearSubscriptions=function(){c()},this.publish=function(e,t,i,o){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!n(e))throw"Illegal argument type: channel must be a string";if(/^\/meta\//.test(e))throw"Illegal argument: cannot publish to meta channels";if(l())throw"Illegal state: already disconnected";r(t)?(o=t,t=i={}):r(i)&&(o=i,i={});var s={channel:e,data:t,_callback:o},a=this._mixin(!1,{},i,s);w(a)},this.getStatus=function(){return ut},this.isDisconnected=l,this.setBackoffIncrement=function(e){_t.backoffIncrement=e},this.getBackoffIncrement=function(){return _t.backoffIncrement},this.getBackoffPeriod=function(){return mt},this.setLogLevel=function(e){_t.logLevel=e},this.registerExtension=function(e,t){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!n(e))throw"Illegal argument type: extension name must be a string";for(var i=!1,o=0;o<bt.length;++o){var s=bt[o];if(s.name===e){i=!0;break}}return i?(this._info("Could not register extension with name",e,"since another extension with the same name already exists"),!1):(bt.push({name:e,extension:t}),this._debug("Registered extension",e),r(t.registered)&&t.registered(e,this),!0)},this.unregisterExtension=function(e){if(!n(e))throw"Illegal argument type: extension name must be a string";for(var t=!1,i=0;i<bt.length;++i){var o=bt[i];if(o.name===e){bt.splice(i,1),t=!0,this._debug("Unregistered extension",e);var s=o.extension;r(s.unregistered)&&s.unregistered();break}}return t},this.getExtension=function(e){for(var t=0;t<bt.length;++t){var n=bt[t];if(n.name===e)return n.extension}return null},this.getName=function(){return st},this.getClientId=function(){return ft},this.getURL=function(){if(nt&&"object"==typeof _t.urls){var e=_t.urls[nt.getType()];if(e)return e}return _t.url},this.getTransport=function(){return nt},this.getConfiguration=function(){return this._mixin(!0,{},_t)},this.getAdvice=function(){return this._mixin(!0,{},yt)},org.cometd.WebSocket=window.WebSocket},org.cometd.Utils={},org.cometd.Utils.isString=function(e){return void 0===e||null===e?!1:"string"==typeof e||e instanceof String},org.cometd.Utils.isArray=function(e){return void 0===e||null===e?!1:e instanceof Array},org.cometd.Utils.inArray=function(e,t){for(var n=0;n<t.length;++n)if(e===t[n])return n;return-1},org.cometd.Utils.setTimeout=function(e,t,n){return window.setTimeout(function(){try{e._debug("Invoking timed function",t),t()}catch(n){e._debug("Exception invoking timed function",t,n)}},n)},org.cometd.Utils.clearTimeout=function(e){window.clearTimeout(e)},org.cometd.JSON={},org.cometd.JSON.toJSON=org.cometd.JSON.fromJSON=function(){throw"Abstract"},org.cometd.Transport=function(){var e,t;this.registered=function(n,r){e=n,t=r},this.unregistered=function(){e=null,t=null},this._debug=function(){t._debug.apply(t,arguments)},this._mixin=function(){return t._mixin.apply(t,arguments)},this.getConfiguration=function(){return t.getConfiguration()},this.getAdvice=function(){return t.getAdvice()},this.setTimeout=function(e,n){return org.cometd.Utils.setTimeout(t,e,n)},this.clearTimeout=function(e){org.cometd.Utils.clearTimeout(e)},this.convertToMessages=function(e){if(org.cometd.Utils.isString(e))try{return org.cometd.JSON.fromJSON(e)}catch(t){throw this._debug("Could not convert to JSON the following string",'"'+e+'"'),t}if(org.cometd.Utils.isArray(e))return e;if(void 0===e||null===e)return[];if(e instanceof Object)return[e];throw"Conversion Error "+e+", typeof "+typeof e},this.accept=function(){throw"Abstract"},this.getType=function(){return e},this.send=function(){throw"Abstract"},this.reset=function(){this._debug("Transport",e,"reset")},this.abort=function(){this._debug("Transport",e,"aborted")},this.toString=function(){return this.getType()}},org.cometd.Transport.derive=function(e){function t(){}return t.prototype=e,new t},org.cometd.RequestTransport=function(){function e(e){for(;f.length>0;){var t=f[0],n=t[0],r=t[1];if(n.url!==e.url||n.sync!==e.sync)break;f.shift(),e.messages=e.messages.concat(n.messages),this._debug("Coalesced",n.messages.length,"messages from request",r.id)}}function t(e,t){if(this.transportSend(e,t),t.expired=!1,!e.sync){var n=this.getConfiguration().maxNetworkDelay,r=n;t.metaConnect===!0&&(r+=this.getAdvice().timeout),this._debug("Transport",this.getType(),"waiting at most",r,"ms for the response, maxNetworkDelay",n);var i=this;t.timeout=this.setTimeout(function(){t.expired=!0;var n="Request "+t.id+" of transport "+i.getType()+" exceeded "+r+" ms max network delay",o={reason:n},s=t.xhr;o.httpCode=i.xhrStatus(s),i.abortXHR(s),i._debug(n),i.complete(t,!1,t.metaConnect),e.onFailure(s,e.messages,o)},r)}}function n(e){var n=++c,r={id:n,metaConnect:!1};l.length<this.getConfiguration().maxConnections-1?(l.push(r),t.call(this,e,r)):(this._debug("Transport",this.getType(),"queueing request",n,"envelope",e),f.push([e,r]))}function r(e){var t=e.id;if(this._debug("Transport",this.getType(),"metaConnect complete, request",t),null!==u&&u.id!==t)throw"Longpoll request mismatch, completing request "+t;u=null}function i(t,r){var i=org.cometd.Utils.inArray(t,l);if(i>=0&&l.splice(i,1),f.length>0){var o=f.shift(),s=o[0],a=o[1];if(this._debug("Transport dequeued request",a.id),r)this.getConfiguration().autoBatch&&e.call(this,s),n.call(this,s),this._debug("Transport completed request",t.id,s);else{var c=this;this.setTimeout(function(){c.complete(a,!1,a.metaConnect);var e={reason:"Previous request failed"},t=a.xhr;e.httpCode=c.xhrStatus(t),s.onFailure(t,s.messages,e)},0)}}}function o(e){if(null!==u)throw"Concurrent metaConnect requests not allowed, request id="+u.id+" not yet completed";var n=++c;this._debug("Transport",this.getType(),"metaConnect send, request",n,"envelope",e);var r={id:n,metaConnect:!0};t.call(this,e,r),u=r}var s=new org.cometd.Transport,a=org.cometd.Transport.derive(s),c=0,u=null,l=[],f=[];return a.complete=function(e,t,n){n?r.call(this,e):i.call(this,e,t)},a.transportSend=function(){throw"Abstract"},a.transportSuccess=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!0,t.metaConnect),n&&n.length>0?e.onSuccess(n):e.onFailure(t.xhr,e.messages,{httpCode:204}))},a.transportFailure=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!1,t.metaConnect),e.onFailure(t.xhr,e.messages,n))},a.send=function(e,t){t?o.call(this,e):n.call(this,e)},a.abort=function(){s.abort();for(var e=0;e<l.length;++e){var t=l[e];this._debug("Aborting request",t),this.abortXHR(t.xhr)}u&&(this._debug("Aborting metaConnect request",u),this.abortXHR(u.xhr)),this.reset()},a.reset=function(){s.reset(),u=null,l=[],f=[]},a.abortXHR=function(e){if(e)try{e.abort()}catch(t){this._debug(t)}},a.xhrStatus=function(e){if(e)try{return e.status}catch(t){this._debug(t)}return-1},a},org.cometd.TransportRegistry=function(){var e=[],t={};this.getTransportTypes=function(){return e.slice(0)},this.findTransportTypes=function(n,r,i){for(var o=[],s=0;s<e.length;++s){var a=e[s];t[a].accept(n,r,i)===!0&&o.push(a)}return o},this.negotiateTransport=function(n,r,i,o){for(var s=0;s<e.length;++s)for(var a=e[s],c=0;c<n.length;++c)if(a===n[c]){var u=t[a];if(u.accept(r,i,o)===!0)return u}return null},this.add=function(n,r,i){for(var o=!1,s=0;s<e.length;++s)if(e[s]===n){o=!0;break}return o||("number"!=typeof i?e.push(n):e.splice(i,0,n),t[n]=r),!o},this.find=function(n){for(var r=0;r<e.length;++r)if(e[r]===n)return t[n];return null},this.remove=function(n){for(var r=0;r<e.length;++r)if(e[r]===n){e.splice(r,1);var i=t[n];return delete t[n],i}return null},this.clear=function(){e=[],t={}},this.reset=function(){for(var n=0;n<e.length;++n)t[e[n]].reset()}},org.cometd.WebSocketTransport=function(){function e(){if(!f){f=!0;var e=r.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",e);try{var t=r.getConfiguration().protocol,n=t?new org.cometd.WebSocket(e,t):new org.cometd.WebSocket(e)}catch(i){throw s=!1,this._debug("Exception while creating WebSocket object",i),i}c=r.getConfiguration().stickyReconnect!==!1;var o=this,a=null,u=r.getConfiguration().connectTimeout;u>0&&(a=this.setTimeout(function(){a=null,o._debug("Transport",o.getType(),"timed out while connecting to URL",e,":",u,"ms");var t={code:1e3,reason:"Connect Timeout"};o.webSocketClose(n,t.code,t.reason),o.onClose(n,t)},u));var l=function(){o._debug("WebSocket opened",n),f=!1,a&&(o.clearTimeout(a),a=null),h?(r._warn("Closing Extra WebSocket Connections",n,h),o.webSocketClose(n,1e3,"Extra Connection")):o.onOpen(n)},d=function(e){e=e||{code:1e3},o._debug("WebSocket closing",n,e),f=!1,a&&(o.clearTimeout(a),a=null),null!==h&&n!==h?o._debug("Closed Extra WebSocket Connection",n):o.onClose(n,e)},p=function(e){o._debug("WebSocket message",e,n),n!==h&&r._warn("Extra WebSocket Connections",n,h),o.onMessage(n,e)};n.onopen=l,n.onclose=d,n.onerror=function(){d({code:1002,reason:"Error"})},n.onmessage=p,this._debug("Transport",this.getType(),"configured callbacks on",n)}}function t(e,t,n){var r=org.cometd.JSON.toJSON(t.messages);e.send(r),this._debug("Transport",this.getType(),"sent",t,"metaConnect =",n);var i=this.getConfiguration().maxNetworkDelay,o=i;n&&(o+=this.getAdvice().timeout,d=!0);for(var s=this,a=[],c=0;c<t.messages.length;++c)!function(){var n=t.messages[c];n.id&&(a.push(n.id),l[n.id]=this.setTimeout(function(){s._debug("Transport",s.getType(),"timing out message",n.id,"after",o,"on",e);var t={code:1e3,reason:"Message Timeout"};s.webSocketClose(e,t.code,t.reason),s.onClose(e,t)},o))}();this._debug("Transport",this.getType(),"waiting at most",o,"ms for messages",a,"maxNetworkDelay",i,", timeouts:",l)}function n(n,r,i){try{null===n?e.call(this):t.call(this,n,r,i)}catch(o){this.setTimeout(function(){r.onFailure(n,r.messages,{exception:o})},0)}}var r,i=new org.cometd.Transport,o=org.cometd.Transport.derive(i),s=!0,a=!1,c=!0,u={},l={},f=!1,h=null,d=!1,p=null;return o.reset=function(){i.reset(),s=!0,a=!1,c=!0,u={},l={},f=!1,h=null,d=!1,p=null},o.onOpen=function(e){this._debug("Transport",this.getType(),"opened",e),h=e,a=!0,this._debug("Sending pending messages",u);for(var n in u){var r=u[n],i=r[0],o=r[1];p=i.onSuccess,t.call(this,e,i,o)}},o.onMessage=function(e,t){this._debug("Transport",this.getType(),"received websocket message",t,e);for(var n=!1,r=this.convertToMessages(t.data),i=[],o=0;o<r.length;++o){var s=r[o];if((/^\/meta\//.test(s.channel)||void 0!==s.successful)&&s.id){i.push(s.id);var a=l[s.id];a&&(this.clearTimeout(a),delete l[s.id],this._debug("Transport",this.getType(),"removed timeout for message",s.id,", timeouts",l))}"/meta/connect"===s.channel&&(d=!1),"/meta/disconnect"!==s.channel||d||(n=!0)}for(var c=!1,f=0;f<i.length;++f){var h=i[f];for(var g in u){var m=g.split(","),v=org.cometd.Utils.inArray(h,m);if(v>=0){c=!0,m.splice(v,1);var b=u[g][0],y=u[g][1];delete u[g],m.length>0&&(u[m.join(",")]=[b,y]);break}}}c&&this._debug("Transport",this.getType(),"removed envelope, envelopes",u),p.call(this,r),n&&this.webSocketClose(e,1e3,"Disconnect")},o.onClose=function(e,t){this._debug("Transport",this.getType(),"closed",e,t),s=c&&a;var n=l;l={};for(var r in n)this.clearTimeout(n[r]);var i=u;u={};for(var o in i){var f=i[o][0],p=i[o][1];p&&(d=!1),f.onFailure(e,f.messages,{websocketCode:t.code,reason:t.reason})}h=null},o.registered=function(e,t){i.registered(e,t),r=t},o.accept=function(){return s&&!!org.cometd.WebSocket&&r.websocketEnabled!==!1},o.send=function(e,t){this._debug("Transport",this.getType(),"sending",e,"metaConnect =",t);for(var r=[],i=0;i<e.messages.length;++i){var o=e.messages[i];o.id&&r.push(o.id)}u[r.join(",")]=[e,t],this._debug("Transport",this.getType(),"stored envelope, envelopes",u),n.call(this,h,e,t)},o.webSocketClose=function(e,t,n){try{e.close(t,n)}catch(r){this._debug(r)}},o.abort=function(){if(i.abort(),h){var e={code:1001,reason:"Abort"};this.webSocketClose(h,e.code,e.reason),this.onClose(h,e)}this.reset()},o},org.cometd.LongPollingTransport=function(){var e=new org.cometd.RequestTransport,t=org.cometd.Transport.derive(e),n=!0;return t.accept=function(e,t){return n||!t},t.xhrSend=function(){throw"Abstract"},t.transportSend=function(e,t){this._debug("Transport",this.getType(),"sending request",t.id,"envelope",e);var r=this;try{var i=!0;t.xhr=this.xhrSend({transport:this,url:e.url,sync:e.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(e.messages),onSuccess:function(i){r._debug("Transport",r.getType(),"received response",i);var o=!1;try{var s=r.convertToMessages(i);0===s.length?(n=!1,r.transportFailure(e,t,{httpCode:204})):(o=!0,r.transportSuccess(e,t,s))}catch(a){if(r._debug(a),!o){n=!1;var c={exception:a};c.httpCode=r.xhrStatus(t.xhr),r.transportFailure(e,t,c)}}},onError:function(o,s){n=!1;var a={reason:o,exception:s};a.httpCode=r.xhrStatus(t.xhr),i?r.setTimeout(function(){r.transportFailure(e,t,a)},0):r.transportFailure(e,t,a)}}),i=!1}catch(o){n=!1,this.setTimeout(function(){r.transportFailure(e,t,{exception:o})},0)}},t.reset=function(){e.reset(),n=!0},t},org.cometd.CallbackPollingTransport=function(){function e(e,t,n){var r=this;return function(){r.transportFailure(e,t,"error",n)}}var t=new org.cometd.RequestTransport,n=org.cometd.Transport.derive(t),r=2e3;return n.accept=function(){return!0},n.jsonpSend=function(){throw"Abstract"},n.transportSend=function(t,n){for(var i=this,o=0,s=t.messages.length,a=[];s>0;){var c=org.cometd.JSON.toJSON(t.messages.slice(o,o+s)),u=t.url.length+encodeURI(c).length;if(u>r){if(1===s){var l="Bayeux message too big ("+u+" bytes, max is "+r+") for transport "+this.getType();return void this.setTimeout(e.call(this,t,n,l),0)}--s}else a.push(s),o+=s,s=t.messages.length-o}var f=t;if(a.length>1){var h=0,d=a[0];this._debug("Transport",this.getType(),"split",t.messages.length,"messages into",a.join(" + ")),f=this._mixin(!1,{},t),f.messages=t.messages.slice(h,d),f.onSuccess=t.onSuccess,f.onFailure=t.onFailure;for(var p=1;p<a.length;++p){var g=this._mixin(!1,{},t);h=d,d+=a[p],g.messages=t.messages.slice(h,d),g.onSuccess=t.onSuccess,g.onFailure=t.onFailure,this.send(g,n.metaConnect)}}this._debug("Transport",this.getType(),"sending request",n.id,"envelope",f);try{var m=!0;this.jsonpSend({transport:this,url:f.url,sync:f.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(f.messages),onSuccess:function(e){var t=!1;try{var r=i.convertToMessages(e);0===r.length?i.transportFailure(f,n,{httpCode:204}):(t=!0,i.transportSuccess(f,n,r))}catch(o){i._debug(o),t||i.transportFailure(f,n,{exception:o})}},onError:function(e,t){var r={reason:e,exception:t};m?i.setTimeout(function(){i.transportFailure(f,n,r)},0):i.transportFailure(f,n,r)}}),m=!1}catch(v){this.setTimeout(function(){i.transportFailure(f,n,{exception:v})},0)}},n},function(){function e(e,t){function n(e,t){if(t)for(var n in t)"content-type"!==n.toLowerCase()&&e.setRequestHeader(n,t[n])}function r(){var r=new t.LongPollingTransport,i=t.Transport.derive(r);return i.xhrSend=function(t){return e.ajax({url:t.url,async:t.sync!==!0,type:"POST",contentType:"application/json;charset=UTF-8",data:t.body,global:!1,xhrFields:{withCredentials:!0},beforeSend:function(e){return e.withCredentials=!0,n(e,t.headers),!0},success:t.onSuccess,error:function(e,n,r){t.onError(n,r)}})},i}function i(){var r=new t.CallbackPollingTransport,i=t.Transport.derive(r);return i.jsonpSend=function(t){e.ajax({url:t.url,async:t.sync!==!0,type:"GET",dataType:"jsonp",jsonp:"jsonp",data:{message:t.body},beforeSend:function(e){return n(e,t.headers),!0},success:t.onSuccess,error:function(e,n,r){t.onError(n,r)}})},i}return t.JSON.toJSON=JSON.stringify,t.JSON.fromJSON=JSON.parse,e.CometD=function(e){var n=new t.CometD(e);return t.WebSocket&&n.registerTransport("websocket",new t.WebSocketTransport),n.registerTransport("long-polling",new r),n.registerTransport("callback-polling",new i),n},e.cometd=new e.CometD,e.cometd}"function"==typeof define&&define.amd?define(["jquery","org/cometd"],e):e(jQuery,org.cometd)}(),function(){"use strict";function e(){}e.prototype=new EventEmitter;var t,n=new e,r=e.prototype,i=this,o=i.ZetaPush,s=$.cometd,a=null,c=!1,u=[];s.addListener("/meta/connect",function(e){if(s.isDisconnected())return c=!1,void log.info("connection closed");var t=c;c=e.successful,!t&&c?(log.info("connection established"),n.emitEvent("ZetaPush_Connected"),s.batch(function(){n.refresh()})):t&&!c&&(log.warn("connection broken"),n.emitEvent("ZetaPush_Disconnected"))}),s.addListener("/meta/disconnect",function(e){log.info("got disconnect"),e.successful&&(c=!1,log.info("connection closed"),n.emitEvent("ZetaPush_Disconnected"))}),s.addListener("/meta/handshake",function(e){e.successful?(log.debug("successful handshake",e),n.emitEvent("ZetaPush_Hanshake_Successful"),t=e.clientId):(log.warn("unsuccessful handshake"),n.emitEvent("ZetaPush_Hanshake_Denied"),t=null)}),r.init=function(e,t){log.setLevel(t),s.configure({url:e,logLevel:t,backoffIncrement:100,maxBackoff:500,appendMessageTypeToURL:!1})},r.disconnect=function(){s.disconnect(!0)},s.onListenerException=function(e,t,n,r){log.error("Uncaught exception for subscription",t,":",e,"message:",r),n?(s.removeListener(t),log.error("removed listener")):(s.unsubscribe(t),log.error("unsubscribed")),disconnect()},r.subscribe=function(e){return c?(e.sub=s.subscribe(e.chan,e.cb),log.debug("subscribed",e)):log.debug("queuing subscription request",e),u.push(e),null==e.renewOnReconnect&&(e.renewOnReconnect=!0),e},r.unsubscribe=function(e){e.sub&&(s.unsubscribe(e.sub),e.sub=null,log.debug("unsubscribed",e)),e.renewOnReconnect=!1},r.refresh=function(){log.debug("refreshing subscriptions");var e=[];u.forEach(function(t){t.sub&&s.unsubscribe(t.sub),t.renewOnReconnect&&e.push(t)}),u=[],e.forEach(function(e){subscribe(e)})},r.publish=function(e,t){c&&s.publish(e,t)},r.makeResourceId=function(){for(var e="",t="abcdefghijklmnopqrstuvwxyz0123456789",n=0;5>n;n++)e+=t.charAt(Math.floor(Math.random()*t.length));localStorage.resource=e},r.connect=function(e){a=e,s.handshake(e)},r.reconnect=function(){connect(a)},e.noConflict=function(){return i.ZetaPush=o,n},"function"==typeof define&&define.amd?define(function(){return n}):"object"==typeof module&&module.exports?module.exports=n:i.zetaPush=n}.call(this);