"use strict";function _typeof(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function _typeof(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function _typeof(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function _typeof(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}window.org=window.org||{},org.cometd={},org.cometd.CometD=function(e){function t(e,t){try{return e[t]}catch(n){return}}function n(e){return org.cometd.Utils.isString(e)}function o(e){return void 0===e||null===e?!1:"function"==typeof e}function r(e,t){for(var n="";--t>0&&!(e>=Math.pow(10,t));)n+="0";return n+=e}function i(e,t){if(window.console){var n=window.console[e];if(o(n)){var i=new Date;[].splice.call(t,0,0,r(i.getHours(),2)+":"+r(i.getMinutes(),2)+":"+r(i.getSeconds(),2)+"."+r(i.getMilliseconds(),3)),n.apply(window.console,t)}}}function s(e){ce._debug("Configuring cometd object with",e),n(e)&&(e={url:e}),e||(e={}),qe=ce._mixin(!1,qe,e);var t=ce.getURL();if(!t)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";var o=/(^https?:\/\/)?(((\[[^\]]+\])|([^:\/\?#]+))(:(\d+))?)?([^\?#]*)(.*)?/.exec(t),r=o[2],i=o[8],s=o[9];if(le=ce._isCrossDomain(r),qe.appendMessageTypeToURL)if(void 0!==s&&s.length>0)ce._info("Appending message type to URI "+i+s+" is not supported, disabling 'appendMessageTypeToURL' configuration"),qe.appendMessageTypeToURL=!1;else{var a=i.split("/"),c=a.length-1;i.match(/\/$/)&&(c-=1),a[c].indexOf(".")>=0&&(ce._info("Appending message type to URI "+i+" is not supported, disabling 'appendMessageTypeToURL' configuration"),qe.appendMessageTypeToURL=!1)}}function a(e){if(e){var t=be[e.channel];t&&t[e.id]&&(delete t[e.id],ce._debug("Removed",e.listener?"listener":"subscription",e))}}function c(e){e&&!e.listener&&a(e)}function u(){for(var e in be){var t=be[e];if(t)for(var n=0;n<t.length;++n)c(t[n])}}function l(e){fe!==e&&(ce._debug("Status",fe,"->",e),fe=e)}function d(){return"disconnecting"===fe||"disconnected"===fe}function f(){var e=++pe;return""+e}function p(e,t,n,r,i){try{return t.call(e,r)}catch(s){var a=ce.onExtensionException;if(o(a)){ce._debug("Invoking extension exception handler",n,s);try{a.call(ce,s,n,i,r)}catch(c){ce._info("Exception during execution of extension exception handler",n,c)}}else ce._info("Exception during execution of extension",n,s);return r}}function h(e){for(var t=0;t<we.length&&(void 0!==e&&null!==e);++t){var n=qe.reverseIncomingExtensions?we.length-1-t:t,r=we[n],i=r.extension.incoming;if(o(i)){var s=p(r.extension,i,r.name,e,!1);e=void 0===s?e:s}}return e}function g(e){for(var t=0;t<we.length&&(void 0!==e&&null!==e);++t){var n=we[t],r=n.extension.outgoing;if(o(r)){var i=p(n.extension,r,n.name,e,!0);e=void 0===i?e:i}}return e}function m(e,t){var n=be[e];if(n&&n.length>0)for(var r=0;r<n.length;++r){var i=n[r];if(i)try{i.callback.call(i.scope,t)}catch(s){var a=ce.onListenerException;if(o(a)){ce._debug("Invoking listener exception handler",i,s);try{a.call(ce,s,i,i.listener,t)}catch(c){ce._info("Exception during execution of listener exception handler",i,c)}}else ce._info("Exception during execution of listener",i,t,s)}}}function v(e,t){m(e,t);for(var n=e.split("/"),o=n.length-1,r=o;r>0;--r){var i=n.slice(0,r).join("/")+"/*";r===o&&m(i,t),i+="*",m(i,t)}}function b(){null!==Te&&org.cometd.Utils.clearTimeout(Te),Te=null}function y(e){b();var t=xe.interval+ye;ce._debug("Function scheduled in",t,"ms, interval =",xe.interval,"backoff =",ye,e),Te=org.cometd.Utils.setTimeout(ce,e,t)}function T(e,t,n,o){for(var r=0;r<t.length;++r){var i=t[r],s=i.id;he&&(i.clientId=he),i=g(i),void 0!==i&&null!==i?(i.id=s,t[r]=i):(delete _e[s],t.splice(r--,1))}if(0!==t.length){var a=ce.getURL();qe.appendMessageTypeToURL&&(a.match(/\/$/)||(a+="/"),o&&(a+=o));var c={url:a,sync:e,messages:t,onSuccess:function(e){try{Re.call(ce,e)}catch(t){ce._info("Exception during handling of messages",t)}},onFailure:function(e,t,n){try{var o=ce.getTransport();n.connectionType=o?o.getType():"unknown",Ie.call(ce,e,t,n)}catch(r){ce._info("Exception during handling of failure",r)}}};ce._debug("Send",c),ie.send(c,n)}}function w(e){ge>0||ve===!0?me.push(e):T(!1,[e],!1)}function x(){ye=0}function _(){ye<qe.maxBackoff&&(ye+=qe.backoffIncrement)}function k(){++ge,ce._debug("Starting batch, depth",ge)}function C(){var e=me;me=[],e.length>0&&T(!1,e,!1)}function S(){if(--ge,ce._debug("Ending batch, depth",ge),0>ge)throw"Calls to startBatch() and endBatch() are not paired";0!==ge||d()||ve||C()}function q(){if(!d()){var e={id:f(),channel:"/meta/connect",connectionType:ie.getType()};Se||(e.advice={timeout:0}),l("connecting"),ce._debug("Connect sent",e),T(!1,[e],!0,"connect"),l("connected")}}function R(){l("connecting"),y(function(){q()})}function I(e){e&&(xe=ce._mixin(!1,{},qe.advice,e),ce._debug("New advice",xe))}function L(e){if(b(),e&&ie&&ie.abort(),he=null,l("disconnected"),ge=0,x(),ie=null,me.length>0){var t=me;me=[],Ie.call(ce,void 0,t,{reason:"Disconnected"})}}function E(e,t,n){var r=ce.onTransportException;if(o(r)){ce._debug("Invoking transport exception handler",e,t,n);try{r.call(ce,n,e,t)}catch(i){ce._info("Exception during execution of transport exception handler",i)}}}function U(e,t){o(e)&&(t=e,e=void 0),he=null,u(),d()?(de.reset(),I(qe.advice)):I(ce._mixin(!1,xe,{reconnect:"retry"})),ge=0,ve=!0,se=e,ae=t;var n="1.0",r=ce.getURL(),i=de.findTransportTypes(n,le,r),s={id:f(),version:n,minimumVersion:n,channel:"/meta/handshake",supportedConnectionTypes:i,advice:{timeout:xe.timeout,interval:xe.interval}},a=ce._mixin(!1,{},se,s);if(ce._putCallback(a.id,t),!ie&&(ie=de.negotiateTransport(i,n,le,r),!ie)){var c="Could not find initial transport among: "+de.getTransportTypes();throw ce._warn(c),c}ce._debug("Initial transport is",ie.getType()),l("handshaking"),ce._debug("Handshake sent",a),T(!1,[a],!1,"handshake")}function O(){l("handshaking"),ve=!0,y(function(){U(se,ae)})}function M(e,t){try{e.call(ce,t)}catch(n){var r=ce.onCallbackException;if(o(r)){ce._debug("Invoking callback exception handler",n);try{r.call(ce,n,t)}catch(i){ce._info("Exception during execution of callback exception handler",i)}}else ce._info("Exception during execution of message callback",n)}}function N(e){var t=ce._getCallback([e.id]);o(t)&&(delete _e[e.id],M(t,e))}function A(e){var t=ke[e.id];if(delete ke[e.id],ce._debug("Handling remote call response for",e,"with context",t),t){var n=t.timeout;n&&org.cometd.Utils.clearTimeout(n);var r=t.callback;if(o(r))return M(r,e),!0}return!1}function D(e){N(e),v("/meta/handshake",e),v("/meta/unsuccessful",e);var t=!d()&&"none"!==xe.reconnect;t?(_(),O()):L(!0)}function z(e){if(e.successful){he=e.clientId;var t=ce.getURL(),n=de.negotiateTransport(e.supportedConnectionTypes,e.version,le,t);if(null===n){var o="Could not negotiate transport with server; client=["+de.findTransportTypes(e.version,le,t)+"], server=["+e.supportedConnectionTypes+"]",r=ce.getTransport();return E(r.getType(),null,{reason:o,connectionType:r.getType(),transport:r}),ce._warn(o),void L(!0)}ie!==n&&(ce._debug("Transport",ie.getType(),"->",n.getType()),ie=n),ve=!1,C(),e.reestablish=Ce,Ce=!0,N(e),v("/meta/handshake",e);var i=d()?"none":xe.reconnect;switch(i){case"retry":x(),R();break;case"none":L(!0);break;default:throw"Unrecognized advice action "+i}}else D(e)}function j(e){var t="1.0",n=ce.getURL(),o=ce.getTransport(),r=de.findTransportTypes(t,le,n),i=de.negotiateTransport(r,t,le,n);i?(ce._debug("Transport",o.getType(),"->",i.getType()),E(o.getType(),i.getType(),e.failure),D(e),ie=i):(E(o.getType(),null,e.failure),ce._warn("Could not negotiate transport; client=["+r+"]"),L(!0),D(e))}function B(e){v("/meta/connect",e),v("/meta/unsuccessful",e);var t=d()?"none":xe.reconnect;switch(t){case"retry":R(),_();break;case"handshake":de.reset(),x(),O();break;case"none":L(!0);break;default:throw"Unrecognized advice action"+t}}function F(e){if(Se=e.successful){v("/meta/connect",e);var t=d()?"none":xe.reconnect;switch(t){case"retry":x(),R();break;case"none":L(!1);break;default:throw"Unrecognized advice action "+t}}else B(e)}function X(e){Se=!1,B(e)}function J(e){L(!0),N(e),v("/meta/disconnect",e),v("/meta/unsuccessful",e)}function H(e){e.successful?(L(!1),N(e),v("/meta/disconnect",e)):J(e)}function P(e){J(e)}function W(e){var t=be[e.subscription];if(t)for(var n=t.length-1;n>=0;--n){var o=t[n];if(o&&!o.listener){delete t[n],ce._debug("Removed failed subscription",o);break}}N(e),v("/meta/subscribe",e),v("/meta/unsuccessful",e)}function G(e){e.successful?(N(e),v("/meta/subscribe",e)):W(e)}function K(e){W(e)}function Q(e){N(e),v("/meta/unsubscribe",e),v("/meta/unsuccessful",e)}function Z(e){e.successful?(N(e),v("/meta/unsubscribe",e)):Q(e)}function $(e){Q(e)}function V(e){A(e)||(N(e),v("/meta/publish",e),v("/meta/unsuccessful",e))}function Y(e){void 0!==e.data?A(e)||v(e.channel,e):void 0===e.successful?ce._warn("Unknown Bayeux Message",e):e.successful?(N(e),v("/meta/publish",e)):V(e)}function ee(e){V(e)}function te(e){if(e=h(e),void 0!==e&&null!==e){I(e.advice);var t=e.channel;switch(t){case"/meta/handshake":z(e);break;case"/meta/connect":F(e);break;case"/meta/disconnect":H(e);break;case"/meta/subscribe":G(e);break;case"/meta/unsubscribe":Z(e);break;default:Y(e)}}}function ne(e){var t=be[e];if(t)for(var n=0;n<t.length;++n)if(t[n])return!0;return!1}function oe(e,t){var r={scope:e,method:t};if(o(e))r.scope=void 0,r.method=e;else if(n(t)){if(!e)throw"Invalid scope "+e;if(r.method=e[t],!o(r.method))throw"Invalid callback "+t+" for scope "+e}else if(!o(t))throw"Invalid callback "+t;return r}function re(e,t,n,o){var r=oe(t,n);ce._debug("Adding",o?"listener":"subscription","on",e,"with scope",r.scope,"and callback",r.method);var i={channel:e,scope:r.scope,callback:r.method,listener:o},s=be[e];return s||(s=[],be[e]=s),i.id=s.push(i)-1,ce._debug("Added",o?"listener":"subscription",i),i[0]=e,i[1]=i.id,i}var ie,se,ae,ce=this,ue=e||"default",le=!1,de=new org.cometd.TransportRegistry,fe="disconnected",pe=0,he=null,ge=0,me=[],ve=!1,be={},ye=0,Te=null,we=[],xe={},_e={},ke={},Ce=!1,Se=!1,qe={protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",reverseIncomingExtensions:!0,maxNetworkDelay:1e4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,advice:{timeout:6e4,interval:0,reconnect:"retry"}};this._mixin=function(e,n,o){for(var r=n||{},i=2;i<arguments.length;++i){var s=arguments[i];if(void 0!==s&&null!==s)for(var a in s){var c=t(s,a),u=t(r,a);if(c!==n&&void 0!==c)if(e&&"object"===("undefined"==typeof c?"undefined":_typeof(c))&&null!==c)if(c instanceof Array)r[a]=this._mixin(e,u instanceof Array?u:[],c);else{var l="object"!==("undefined"==typeof u?"undefined":_typeof(u))||u instanceof Array?{}:u;r[a]=this._mixin(e,l,c)}else r[a]=c}}return r},this._warn=function(){i("warn",arguments)},this._info=function(){"warn"!==qe.logLevel&&i("info",arguments)},this._debug=function(){"debug"===qe.logLevel&&i("debug",arguments)},this._isCrossDomain=function(e){return e&&e!==window.location.host};var Re,Ie;this.send=w,this._getCallback=function(e){return _e[e]},this._putCallback=function(e,t){var n=this._getCallback(e);return o(t)&&(_e[e]=t),n},this.receive=te,Re=function(e){ce._debug("Received",e);for(var t=0;t<e.length;++t){var n=e[t];te(n)}},Ie=function(e,t,n){ce._debug("handleFailure",e,t,n),n.transport=e;for(var o=0;o<t.length;++o){var r=t[o],i={id:r.id,successful:!1,channel:r.channel,failure:n};switch(n.message=r,r.channel){case"/meta/handshake":j(i);break;case"/meta/connect":X(i);break;case"/meta/disconnect":P(i);break;case"/meta/subscribe":i.subscription=r.subscription,K(i);break;case"/meta/unsubscribe":i.subscription=r.subscription,$(i);break;default:ee(i)}}},this.registerTransport=function(e,t,n){var r=de.add(e,t,n);return r&&(this._debug("Registered transport",e),o(t.registered)&&t.registered(e,this)),r},this.getTransportTypes=function(){return de.getTransportTypes()},this.unregisterTransport=function(e){var t=de.remove(e);return null!==t&&(this._debug("Unregistered transport",e),o(t.unregistered)&&t.unregistered()),t},this.unregisterTransports=function(){de.clear()},this.findTransport=function(e){return de.find(e)},this.configure=function(e){s.call(this,e)},this.init=function(e,t){this.configure(e),this.handshake(t)},this.handshake=function(e,t){l("disconnected"),Ce=!1,U(e,t)},this.disconnect=function(e,t,n){if(!d()){"boolean"!=typeof e&&(n=t,t=e,e=!1),o(t)&&(n=t,t=void 0);var r={id:f(),channel:"/meta/disconnect"},i=this._mixin(!1,{},t,r);ce._putCallback(i.id,n),l("disconnecting"),T(e===!0,[i],!1,"disconnect")}},this.startBatch=function(){k()},this.endBatch=function(){S()},this.batch=function(e,t){var n=oe(e,t);this.startBatch();try{n.method.call(n.scope),this.endBatch()}catch(o){throw this._info("Exception during execution of batch",o),this.endBatch(),o}},this.addListener=function(e,t,o){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!n(e))throw"Illegal argument type: channel must be a string";return re(e,t,o,!0)},this.removeListener=function(e){if(!(e&&e.channel&&"id"in e))throw"Invalid argument: expected subscription, not "+e;a(e)},this.clearListeners=function(){be={}},this.subscribe=function(e,t,r,i,s){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!n(e))throw"Illegal argument type: channel must be a string";if(d())throw"Illegal state: already disconnected";o(t)&&(s=i,i=r,r=t,t=void 0),o(i)&&(s=i,i=void 0);var a=!ne(e),c=re(e,t,r,!1);if(a){var u={id:f(),channel:"/meta/subscribe",subscription:e},l=this._mixin(!1,{},i,u);ce._putCallback(l.id,s),w(l)}return c},this.unsubscribe=function(e,t,n){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(d())throw"Illegal state: already disconnected";o(t)&&(n=t,t=void 0),this.removeListener(e);var r=e.channel;if(!ne(r)){var i={id:f(),channel:"/meta/unsubscribe",subscription:r},s=this._mixin(!1,{},t,i);ce._putCallback(s.id,n),w(s)}},this.resubscribe=function(e,t){return c(e),e?this.subscribe(e.channel,e.scope,e.callback,t):void 0},this.clearSubscriptions=function(){u()},this.publish=function(e,t,r,i){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!n(e))throw"Illegal argument type: channel must be a string";if(/^\/meta\//.test(e))throw"Illegal argument: cannot publish to meta channels";if(d())throw"Illegal state: already disconnected";o(t)?(i=t,t=r={}):o(r)&&(i=r,r={});var s={id:f(),channel:e,data:t},a=this._mixin(!1,{},r,s);ce._putCallback(a.id,i),w(a)},this.remoteCall=function(e,t,r,i){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!n(e))throw"Illegal argument type: target must be a string";if(d())throw"Illegal state: already disconnected";if(o(t)?(i=t,t={},r=qe.maxNetworkDelay):o(r)&&(i=r,r=qe.maxNetworkDelay),"number"!=typeof r)throw"Illegal argument type: timeout must be a number";e.match(/^\//)||(e="/"+e);var s="/service"+e,a={id:f(),channel:s,data:t},c={callback:i};r>0&&(c.timeout=org.cometd.Utils.setTimeout(ce,function(){ce._debug("Timing out remote call",a,"after",r,"ms"),V({id:a.id,error:"406::timeout",successful:!1,failure:{message:a,reason:"Remote Call Timeout"}})},r),ce._debug("Scheduled remote call timeout",a,"in",r,"ms")),ke[a.id]=c,w(a)},this.getStatus=function(){return fe},this.isDisconnected=d,this.setBackoffIncrement=function(e){qe.backoffIncrement=e},this.getBackoffIncrement=function(){return qe.backoffIncrement},this.getBackoffPeriod=function(){return ye},this.setLogLevel=function(e){qe.logLevel=e},this.registerExtension=function(e,t){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!n(e))throw"Illegal argument type: extension name must be a string";for(var r=!1,i=0;i<we.length;++i){var s=we[i];if(s.name===e){r=!0;break}}return r?(this._info("Could not register extension with name",e,"since another extension with the same name already exists"),!1):(we.push({name:e,extension:t}),this._debug("Registered extension",e),o(t.registered)&&t.registered(e,this),!0)},this.unregisterExtension=function(e){if(!n(e))throw"Illegal argument type: extension name must be a string";for(var t=!1,r=0;r<we.length;++r){var i=we[r];if(i.name===e){we.splice(r,1),t=!0,this._debug("Unregistered extension",e);var s=i.extension;o(s.unregistered)&&s.unregistered();break}}return t},this.getExtension=function(e){for(var t=0;t<we.length;++t){var n=we[t];if(n.name===e)return n.extension}return null},this.getName=function(){return ue},this.getClientId=function(){return he},this.getURL=function(){if(ie&&"object"===_typeof(qe.urls)){var e=qe.urls[ie.getType()];if(e)return e}return qe.url},this.getTransport=function(){return ie},this.getConfiguration=function(){return this._mixin(!0,{},qe)},this.getAdvice=function(){return this._mixin(!0,{},xe)},org.cometd.WebSocket=window.WebSocket,this.notifyListeners=v},org.cometd.Utils={},org.cometd.Utils.isString=function(e){return void 0===e||null===e?!1:"string"==typeof e||e instanceof String},org.cometd.Utils.isArray=function(e){return void 0===e||null===e?!1:e instanceof Array},org.cometd.Utils.inArray=function(e,t){for(var n=0;n<t.length;++n)if(e===t[n])return n;return-1},org.cometd.Utils.setTimeout=function(e,t,n){return window.setTimeout(function(){try{e._debug("Invoking timed function",t),t()}catch(n){e._debug("Exception invoking timed function",t,n)}},n)},org.cometd.Utils.clearTimeout=function(e){window.clearTimeout(e)},org.cometd.JSON={},org.cometd.JSON.toJSON=org.cometd.JSON.fromJSON=function(e){throw"Abstract"},org.cometd.Transport=function(){var e,t;this.registered=function(n,o){e=n,t=o},this.unregistered=function(){e=null,t=null},this._debug=function(){t._debug.apply(t,arguments)},this._mixin=function(){return t._mixin.apply(t,arguments)},this.getConfiguration=function(){return t.getConfiguration()},this.getAdvice=function(){return t.getAdvice()},this.setTimeout=function(e,n){return org.cometd.Utils.setTimeout(t,e,n)},this.clearTimeout=function(e){org.cometd.Utils.clearTimeout(e)},this.convertToMessages=function(e){if(org.cometd.Utils.isString(e))try{return org.cometd.JSON.fromJSON(e)}catch(t){throw this._debug("Could not convert to JSON the following string",'"'+e+'"'),t}if(org.cometd.Utils.isArray(e))return e;if(void 0===e||null===e)return[];if(e instanceof Object)return[e];throw"Conversion Error "+e+", typeof "+("undefined"==typeof e?"undefined":_typeof(e))},this.accept=function(e,t,n){throw"Abstract"},this.getType=function(){return e},this.send=function(e,t){throw"Abstract"},this.reset=function(){this._debug("Transport",e,"reset")},this.abort=function(){this._debug("Transport",e,"aborted")},this.toString=function(){return this.getType()}},org.cometd.Transport.derive=function(e){function t(){}return t.prototype=e,new t},org.cometd.RequestTransport=function(){function e(e){for(;d.length>0;){var t=d[0],n=t[0],o=t[1];if(n.url!==e.url||n.sync!==e.sync)break;d.shift(),e.messages=e.messages.concat(n.messages),this._debug("Coalesced",n.messages.length,"messages from request",o.id)}}function t(e,t){if(this.transportSend(e,t),t.expired=!1,!e.sync){var n=this.getConfiguration().maxNetworkDelay,o=n;t.metaConnect===!0&&(o+=this.getAdvice().timeout),this._debug("Transport",this.getType(),"waiting at most",o,"ms for the response, maxNetworkDelay",n);var r=this;t.timeout=this.setTimeout(function(){t.expired=!0;var n="Request "+t.id+" of transport "+r.getType()+" exceeded "+o+" ms max network delay",i={reason:n},s=t.xhr;i.httpCode=r.xhrStatus(s),r.abortXHR(s),r._debug(n),r.complete(t,!1,t.metaConnect),e.onFailure(s,e.messages,i)},o)}}function n(e){var n=++c,o={id:n,metaConnect:!1,envelope:e};l.length<this.getConfiguration().maxConnections-1?(l.push(o),t.call(this,e,o)):(this._debug("Transport",this.getType(),"queueing request",n,"envelope",e),d.push([e,o]))}function o(e){var t=e.id;if(this._debug("Transport",this.getType(),"metaConnect complete, request",t),null!==u&&u.id!==t)throw"Longpoll request mismatch, completing request "+t;u=null}function r(t,o){var r=org.cometd.Utils.inArray(t,l);if(r>=0&&l.splice(r,1),d.length>0){var i=d.shift(),s=i[0],a=i[1];if(this._debug("Transport dequeued request",a.id),o)this.getConfiguration().autoBatch&&e.call(this,s),n.call(this,s),this._debug("Transport completed request",t.id,s);else{var c=this;this.setTimeout(function(){c.complete(a,!1,a.metaConnect);var e={reason:"Previous request failed"},t=a.xhr;e.httpCode=c.xhrStatus(t),s.onFailure(t,s.messages,e)},0)}}}function i(e){if(null!==u)throw"Concurrent metaConnect requests not allowed, request id="+u.id+" not yet completed";var n=++c;this._debug("Transport",this.getType(),"metaConnect send, request",n,"envelope",e);var o={id:n,metaConnect:!0,envelope:e};t.call(this,e,o),u=o}var s=new org.cometd.Transport,a=org.cometd.Transport.derive(s),c=0,u=null,l=[],d=[];return a.complete=function(e,t,n){n?o.call(this,e):r.call(this,e,t)},a.transportSend=function(e,t){throw"Abstract"},a.transportSuccess=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!0,t.metaConnect),n&&n.length>0?e.onSuccess(n):e.onFailure(t.xhr,e.messages,{httpCode:204}))},a.transportFailure=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!1,t.metaConnect),e.onFailure(t.xhr,e.messages,n))},a.send=function(e,t){t?i.call(this,e):n.call(this,e)},a.abort=function(){s.abort();for(var e=0;e<l.length;++e){var t=l[e];t&&(this._debug("Aborting request",t),this.abortXHR(t.xhr)||this.transportFailure(t.envelope,t,{reason:"abort"}))}u&&(this._debug("Aborting metaConnect request",u),this.abortXHR(u.xhr)||this.transportFailure(u.envelope,u,{reason:"abort"})),this.reset()},a.reset=function(){s.reset(),u=null,l=[],d=[]},a.abortXHR=function(e){if(e)try{var t=e.readyState;return e.abort(),t!==XMLHttpRequest.UNSENT}catch(n){this._debug(n)}return!1},a.xhrStatus=function(e){if(e)try{return e.status}catch(t){this._debug(t)}return-1},a},org.cometd.TransportRegistry=function(){var e=[],t={};this.getTransportTypes=function(){return e.slice(0)},this.findTransportTypes=function(n,o,r){for(var i=[],s=0;s<e.length;++s){var a=e[s];t[a].accept(n,o,r)===!0&&i.push(a)}return i},this.negotiateTransport=function(n,o,r,i){for(var s=0;s<e.length;++s)for(var a=e[s],c=0;c<n.length;++c)if(a===n[c]){var u=t[a];if(u.accept(o,r,i)===!0)return u}return null},this.add=function(n,o,r){for(var i=!1,s=0;s<e.length;++s)if(e[s]===n){i=!0;break}return i||("number"!=typeof r?e.push(n):e.splice(r,0,n),t[n]=o),!i},this.find=function(n){for(var o=0;o<e.length;++o)if(e[o]===n)return t[n];return null},this.remove=function(n){for(var o=0;o<e.length;++o)if(e[o]===n){e.splice(o,1);var r=t[n];return delete t[n],r}return null},this.clear=function(){e=[],t={}},this.reset=function(){for(var n=0;n<e.length;++n)t[e[n]].reset()}},org.cometd.WebSocketTransport=function(){function e(){if(!d){d=!0;var e=o.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",e);var t;try{var n=o.getConfiguration().protocol;t=n?new org.cometd.WebSocket(e,n):new org.cometd.WebSocket(e)}catch(r){throw s=!1,this._debug("Exception while creating WebSocket object",r),r}c=o.getConfiguration().stickyReconnect!==!1;var i=this,a=null,u=o.getConfiguration().connectTimeout;u>0&&(a=setTimeout(function(){a=null,i._debug("Transport",i.getType(),"timed out while connecting to URL",e,":",u,"ms");var n={code:1e3,reason:"Connect Timeout"};i.webSocketClose(t,n.code,n.reason),i.onClose(t,n)},u));var l=function(){i._debug("WebSocket opened",t),d=!1,a&&(i.clearTimeout(a),a=null),f?(o._warn("Closing Extra WebSocket Connections",t,f),i.webSocketClose(t,1e3,"Extra Connection")):i.onOpen(t)},p=function(e){e=e||{code:1e3},i._debug("WebSocket closing",t,e),d=!1,a&&(i.clearTimeout(a),a=null),null!==f&&t!==f?i._debug("Closed Extra WebSocket Connection",t):i.onClose(t,e)},h=function(e){i._debug("WebSocket message",e,t),t!==f&&o._warn("Extra WebSocket Connections",t,f),i.onMessage(t,e)};t.onopen=l,t.onclose=p,t.onerror=function(){p({code:1002,reason:"Error"})},t.onmessage=h,this._debug("Transport",this.getType(),"configured callbacks on",t)}}function t(e,t,n){var o=org.cometd.JSON.toJSON(t.messages);e.send(o),this._debug("Transport",this.getType(),"sent",t,"metaConnect =",n);var r=this.getConfiguration().maxNetworkDelay,i=r;n&&(i+=this.getAdvice().timeout,p=!0);for(var s=this,a=[],c=0;c<t.messages.length;++c)!function(){var n=t.messages[c];n.id&&(a.push(n.id),l[n.id]=setTimeout(function(){s._debug("Transport",s.getType(),"timing out message",n.id,"after",i,"on",e);var t={code:1e3,reason:"Message Timeout"};s.webSocketClose(e,t.code,t.reason),s.onClose(e,t)},i))}();this._debug("Transport",this.getType(),"waiting at most",i,"ms for messages",a,"maxNetworkDelay",r,", timeouts:",l)}function n(n,o,r){try{null===n?e.call(this):t.call(this,n,o,r)}catch(i){setTimeout(function(){o.onFailure(n,o.messages,{exception:i})},0)}}var o,r=new org.cometd.Transport,i=org.cometd.Transport.derive(r),s=!0,a=!1,c=!0,u={},l={},d=!1,f=null,p=!1,h=null;return i.reset=function(){r.reset(),s=!0,a=!1,c=!0,u={},l={},d=!1,p=!1},i.onOpen=function(e){this._debug("Transport",this.getType(),"opened",e),f=e,a=!0,this._debug("Sending pending messages",u);for(var n in u){var o=u[n],r=o[0],i=o[1];h=r.onSuccess,t.call(this,e,r,i)}},i.onMessage=function(e,t){this._debug("Transport",this.getType(),"received websocket message",t,e);for(var n=!1,o=this.convertToMessages(t.data),r=[],i=0;i<o.length;++i){var s=o[i];if((/^\/meta\//.test(s.channel)||void 0===s.data)&&s.id){r.push(s.id);var a=l[s.id];a&&(this.clearTimeout(a),delete l[s.id],this._debug("Transport",this.getType(),"removed timeout for message",s.id,", timeouts",l))}"/meta/connect"===s.channel&&(p=!1),"/meta/disconnect"!==s.channel||p||(n=!0)}for(var c=!1,d=0;d<r.length;++d){var f=r[d];for(var g in u){var m=g.split(","),v=org.cometd.Utils.inArray(f,m);if(v>=0){c=!0,m.splice(v,1);var b=u[g][0],y=u[g][1];delete u[g],m.length>0&&(u[m.join(",")]=[b,y]);break}}}c&&this._debug("Transport",this.getType(),"removed envelope, envelopes",u),h.call(this,o),n&&this.webSocketClose(e,1e3,"Disconnect")},i.onClose=function(e,t){this._debug("Transport",this.getType(),"closed",e,t),s=c&&a;var n=l;l={};for(var o in n)this.clearTimeout(n[o]);var r=u;u={};for(var i in r){var d=r[i][0],h=r[i][1];h&&(p=!1),d.onFailure(e,d.messages,{websocketCode:t.code,reason:t.reason})}f=null},i.registered=function(e,t){r.registered(e,t),o=t},i.accept=function(e,t,n){return s&&!!org.cometd.WebSocket&&o.websocketEnabled!==!1},i.send=function(e,t){this._debug("Transport",this.getType(),"sending",e,"metaConnect =",t);for(var o=[],r=0;r<e.messages.length;++r){var i=e.messages[r];i.id&&o.push(i.id)}u[o.join(",")]=[e,t],this._debug("Transport",this.getType(),"stored envelope, envelopes",u),n.call(this,f,e,t)},i.webSocketClose=function(e,t,n){try{e.close(t,n)}catch(o){this._debug(o)}},i.abort=function(){if(r.abort(),f){var e={code:1001,reason:"Abort"};this.webSocketClose(f,e.code,e.reason),this.onClose(f,e)}this.reset()},i},org.cometd.LongPollingTransport=function(){var e=new org.cometd.RequestTransport,t=org.cometd.Transport.derive(e),n=!0;return t.accept=function(e,t,o){return n||!t},t.xhrSend=function(e){throw"Abstract"},t.transportSend=function(e,t){this._debug("Transport",this.getType(),"sending request",t.id,"envelope",e);var o=this;try{var r=!0;t.xhr=this.xhrSend({transport:this,url:e.url,sync:e.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(e.messages),onSuccess:function(r){o._debug("Transport",o.getType(),"received response",r);var i=!1;try{var s=o.convertToMessages(r);0===s.length?(n=!1,o.transportFailure(e,t,{httpCode:204})):(i=!0,o.transportSuccess(e,t,s))}catch(a){if(o._debug(a),!i){n=!1;var c={exception:a};c.httpCode=o.xhrStatus(t.xhr),o.transportFailure(e,t,c)}}},onError:function(i,s){o._debug("Transport",o.getType(),"received error",i,s),n=!1;var a={reason:i,exception:s};a.httpCode=o.xhrStatus(t.xhr),r?o.setTimeout(function(){o.transportFailure(e,t,a)},0):o.transportFailure(e,t,a)}}),r=!1}catch(i){n=!1,this.setTimeout(function(){o.transportFailure(e,t,{exception:i})},0)}},t.reset=function(){e.reset(),n=!0},t},function(e,t,n){e[t]=n}(window,"qwest",function(){var win=window,doc=document,_before,defaultXdrResponseType="json",_limit=null,requests=0,request_stack=[],getXHR=function(){return win.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},xhr2=""===getXHR().responseType,qwest=function qwest(method,url,data,options,before){method=method.toUpperCase(),data=data||null,options=options||{};var nativeResponseParsing=!1,crossOrigin,xhr,xdr=!1,timeoutInterval,aborted=!1,attempts=0,headers={},mimeTypes={text:"*/*",xml:"text/xml",json:"application/json",post:"application/x-www-form-urlencoded"},accept={text:"*/*",xml:"application/xml; q=1.0, text/xml; q=0.8, */*; q=0.1",json:"application/json; q=1.0, text/*; q=0.8, */*; q=0.1"},contentType="Content-Type",vars="",i,j,serialized,then_stack=[],catch_stack=[],complete_stack=[],response,success,error,func,promises={then:function(e){return options.async?then_stack.push(e):success&&e.call(xhr,response),promises},"catch":function(e){return options.async?catch_stack.push(e):error&&e.call(xhr,response),promises},complete:function(e){return options.async?complete_stack.push(e):e.call(xhr),promises}},promises_limit={then:function(e){return request_stack[request_stack.length-1].then.push(e),promises_limit},"catch":function(e){return request_stack[request_stack.length-1]["catch"].push(e),promises_limit},complete:function(e){return request_stack[request_stack.length-1].complete.push(e),promises_limit}},handleResponse=function handleResponse(){if(!aborted){var i,req,p,responseType;if(--requests,clearInterval(timeoutInterval),request_stack.length){for(req=request_stack.shift(),p=qwest(req.method,req.url,req.data,req.options,req.before),i=0;func=req.then[i];++i)p.then(func);for(i=0;func=req["catch"][i];++i)p["catch"](func);for(i=0;func=req.complete[i];++i)p.complete(func)}try{if("status"in xhr&&!/^2|1223/.test(xhr.status))throw xhr.status+" ("+xhr.statusText+")";var responseText="responseText",responseXML="responseXML",parseError="parseError";if(nativeResponseParsing&&"response"in xhr&&null!==xhr.response)response=xhr.response;else if("document"==options.responseType){var frame=doc.createElement("iframe");frame.style.display="none",doc.body.appendChild(frame),frame.contentDocument.open(),frame.contentDocument.write(xhr.response),frame.contentDocument.close(),response=frame.contentDocument,doc.body.removeChild(frame)}else{if(responseType=options.responseType,"auto"==responseType)if(xdr)responseType=defaultXdrResponseType;else{var ct=xhr.getResponseHeader(contentType);responseType=ct.indexOf(mimeTypes.json)>-1?"json":ct.indexOf(mimeTypes.xml)>-1?"xml":"text"}switch(responseType){case"json":try{response="JSON"in win?JSON.parse(xhr[responseText]):eval("("+xhr[responseText]+")")}catch(e){throw"Error while parsing JSON body : "+e}break;case"xml":try{win.DOMParser?response=(new DOMParser).parseFromString(xhr[responseText],"text/xml"):(response=new ActiveXObject("Microsoft.XMLDOM"),response.async="false",response.loadXML(xhr[responseText]))}catch(e){response=void 0}if(!response||!response.documentElement||response.getElementsByTagName("parsererror").length)throw"Invalid XML";break;default:response=xhr[responseText]}}if(success=!0,p=response,options.async)for(i=0;func=then_stack[i];++i)p=func.call(xhr,p)}catch(e){if(error=!0,options.async)for(i=0;func=catch_stack[i];++i)func.call(xhr,e,url)}if(options.async)for(i=0;func=complete_stack[i];++i)func.call(xhr)}},handleError=function(e){if(error=!0,--requests,clearInterval(timeoutInterval),options.async)for(i=0;func=catch_stack[i];++i)func.call(xhr,e,url)},buildData=function e(t,n){var o,r=[],i=encodeURIComponent;if("object"===("undefined"==typeof t?"undefined":_typeof(t))&&null!=t){
for(o in t)if(t.hasOwnProperty(o)){var s=e(t[o],n?n+"["+o+"]":o);""!==s&&(r=r.concat(s))}}else null!=t&&null!=n&&r.push(i(n)+"="+i(t));return r.join("&")};switch(++requests,"retries"in options&&(win.console&&console.warn&&console.warn('[Qwest] The retries option is deprecated. It indicates total number of requests to attempt. Please use the "attempts" option.'),options.attempts=options.retries),options.async="async"in options?!!options.async:!0,options.cache="cache"in options?!!options.cache:"GET"!=method,options.dataType="dataType"in options?options.dataType.toLowerCase():"post",options.responseType="responseType"in options?options.responseType.toLowerCase():"auto",options.user=options.user||"",options.password=options.password||"",options.withCredentials=!!options.withCredentials,options.timeout="timeout"in options?parseInt(options.timeout,10):3e3,options.attempts="attempts"in options?parseInt(options.attempts,10):3,i=url.match(/\/\/(.+?)\//),crossOrigin=i&&i[1]?i[1]!=location.host:!1,"ArrayBuffer"in win&&data instanceof ArrayBuffer?options.dataType="arraybuffer":"Blob"in win&&data instanceof Blob?options.dataType="blob":"Document"in win&&data instanceof Document?options.dataType="document":"FormData"in win&&data instanceof FormData&&(options.dataType="formdata"),options.dataType){case"json":data=JSON.stringify(data);break;case"post":data=buildData(data)}if(options.headers){var format=function(e,t,n){return t+n.toUpperCase()};for(i in options.headers)headers[i.replace(/(^|-)([^-])/g,format)]=options.headers[i]}if(headers[contentType]||"GET"==method||options.dataType in mimeTypes&&mimeTypes[options.dataType]&&(headers[contentType]=mimeTypes[options.dataType]),headers.Accept||(headers.Accept=options.responseType in accept?accept[options.responseType]:"*/*"),crossOrigin||headers["X-Requested-With"]||(headers["X-Requested-With"]="XMLHttpRequest"),"GET"==method&&data&&(vars+=data),options.cache||(vars&&(vars+="&"),vars+="__t="+ +new Date),vars&&(url+=(/\?/.test(url)?"&":"?")+vars),_limit&&requests==_limit)return request_stack.push({method:method,url:url,data:data,options:options,before:before,then:[],"catch":[],complete:[]}),promises_limit;var send=function(){if(xhr=getXHR(),crossOrigin&&("withCredentials"in xhr||!win.XDomainRequest||(xhr=new XDomainRequest,xdr=!0,"GET"!=method&&"POST"!=method&&(method="POST"))),xdr?xhr.open(method,url):(xhr.open(method,url,options.async,options.user,options.password),xhr2&&options.async&&(xhr.withCredentials=options.withCredentials)),!xdr)for(var e in headers)xhr.setRequestHeader(e,headers[e]);if(xhr2&&"document"!=options.responseType)try{xhr.responseType=options.responseType,nativeResponseParsing=xhr.responseType==options.responseType}catch(t){}xhr2||xdr?(xhr.onload=handleResponse,xhr.onerror=handleError):xhr.onreadystatechange=function(){4==xhr.readyState&&handleResponse()},"auto"!==options.responseType&&"overrideMimeType"in xhr&&xhr.overrideMimeType(mimeTypes[options.responseType]),before&&before.call(xhr),xdr?setTimeout(function(){xhr.send("GET"!=method?data:null)},0):xhr.send("GET"!=method?data:null)},timeout=function t(){timeoutInterval=setTimeout(function(){if(aborted=!0,xhr.abort(),options.attempts&&++attempts==options.attempts){if(aborted=!1,error=!0,response="Timeout ("+url+")",options.async)for(i=0;func=catch_stack[i];++i)func.call(xhr,response)}else aborted=!1,t(),send()},options.timeout)};return timeout(),send(),promises},create=function(e){return function(t,n,o){var r=_before;return _before=null,qwest(e,t,n,o,r)}},obj={before:function(e){return _before=e,obj},get:create("GET"),post:create("POST"),put:create("PUT"),"delete":create("DELETE"),xhr2:xhr2,limit:function(e){_limit=e},setDefaultXdrResponseType:function(e){defaultXdrResponseType=e.toLowerCase()}};return obj}()),function(e,t){e.log=t()}(window,function(){function e(e){return("undefined"==typeof console?"undefined":_typeof(console))===c?!1:void 0!==console[e]?t(console,e):void 0!==console.log?t(console,"log"):a}function t(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(o){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function n(e,t){return function(){("undefined"==typeof console?"undefined":_typeof(console))!==c&&(o(t),s[e].apply(s,arguments))}}function o(e){for(var t=0;t<u.length;t++){var n=u[t];s[n]=e>t?a:s.methodFactory(n,e)}}function r(e){var t=(u[e]||"silent").toUpperCase();try{return void(window.localStorage.loglevel=t)}catch(n){}try{window.document.cookie="loglevel="+t+";"}catch(n){}}function i(){var e;try{e=window.localStorage.loglevel}catch(t){}if(("undefined"==typeof e?"undefined":_typeof(e))===c)try{e=/loglevel=([^;]+)/.exec(window.document.cookie)[1]}catch(t){}void 0===s.levels[e]&&(e="WARN"),s.setLevel(s.levels[e])}var s={},a=function(){},c="undefined",u=["trace","debug","info","warn","error"];s.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},s.methodFactory=function(t,o){return e(t)||n(t,o)},s.setLevel=function(e){if("string"==typeof e&&void 0!==s.levels[e.toUpperCase()]&&(e=s.levels[e.toUpperCase()]),!("number"==typeof e&&e>=0&&e<=s.levels.SILENT))throw"log.setLevel() called with invalid level: "+e;return r(e),o(e),("undefined"==typeof console?"undefined":_typeof(console))===c&&e<s.levels.SILENT?"No console available for logging":void 0},s.enableAll=function(){s.setLevel(s.levels.TRACE)},s.disableAll=function(){s.setLevel(s.levels.SILENT)};var l=("undefined"==typeof window?"undefined":_typeof(window))!==c?window.log:void 0;return s.noConflict=function(){return("undefined"==typeof window?"undefined":_typeof(window))!==c&&window.log===s&&(window.log=l),s},i(),s}),function(){function e(){this.authent={},this.service={}}function t(e,t){if(t)for(var n in t)e[n]=t[n]}function n(){var e=new org.cometd.LongPollingTransport,n=org.cometd.Transport.derive(e);return n.xhrSend=function(e){var n=[];n["Content-Type"]="application/json;charset=UTF-8",t(n,e.headers),qwest.post(e.url,e.body,{async:e.sync!==!0,headers:n,dataType:"-",withCredentials:!0,timeout:12e4}).then(e.onSuccess)["catch"](function(t,n){var o="Connection Failed for server "+n;e.onError(o,t)})},n}function o(e,t,n,o){var r=[];r["Content-Type"]="application/json;charset=UTF-8",qwest.get(n+e,null,{dataType:"-",headers:r,responseType:"json",cache:!0}).then(function(t){t.lastCheck=Date.now(),t.lastBusinessId=e;var n=null;p=t.servers,o(n,t.servers[Math.floor(Math.random()*t.servers.length)])})["catch"](function(t,n){log.error("Error retrieving server url list for businessId",e),o(t,null)})}var r=new e,i=e.prototype,s=this;s.ZP;org.cometd.JSON.toJSON=JSON.stringify,org.cometd.JSON.fromJSON=JSON.parse;var a=new org.cometd.CometD;org.cometd.WebSocket&&a.registerTransport("websocket",new org.cometd.WebSocketTransport),a.registerTransport("long-polling",new n);var c=null,u=!1,l=null,d=null,f=null,p=[],h=null,g=[];a.addListener("/meta/connect",function(e){if(a.isDisconnected())return u=!1,void log.info("connection closed");var t=u;u=e.successful,!t&&u?(log.info("connection established"),a.notifyListeners("/meta/connected",e),a.batch(function(){r.refresh()})):t&&!u&&log.warn("connection broken")}),a.addListener("/meta/handshake",function(e){e.successful?(log.debug("successful handshake",e),d=e.clientId):(log.warn("unsuccessful handshake"),d=null)}),a.onTransportException=function(e,t){if("long-polling"===t){log.debug("onTransportException for long-polling");for(var n=p.length-1;n>=0;n--)if(p[n]===f){p.splice(n,1);break}0===p.length?log.info("No more server available"):(f=p[Math.floor(Math.random()*p.length)],a.configure({url:f+"/strd"}),log.debug("CometD Url",f),setTimeout(function(){a.handshake(c)},500))}},i.init=function(e,t){l=e,h=1==arguments.length?"info":t,log.setLevel(h)},i.connect=function(e,t){i.isConnected()||(1===arguments.length&&(t="http://api.zpush.io/"),c=e,o(l,!1,t,function(t,n){f=n,"debug"===h&&(a.websocketEnabled=!1),a.configure({url:f+"/strd",logLevel:h,backoffIncrement:100,maxBackoff:500,appendMessageTypeToURL:!1}),a.handshake(e)}))},i.onConnected=function(e){i.on("/meta/connected",e)},i.onHandshake=function(e){i.on("/meta/handshake",e)},i.isConnected=function(e){return e?e==c.ext.authentication.type&&!a.isDisconnected():!a.isDisconnected()},i.generateChannel=function(e,t){return"/service/"+l+"/"+e+"/"+t},i.generateMetaChannel=function(e,t){return"/meta/"+l+"/"+e+"/"+t},i.on=function(e,t,n,o){if(1==arguments.length)var r=arguments[0];else if(2==arguments.length){var r={};r.channel=arguments[0],r.callback=arguments[1],g.push(r)}else{if(4!=arguments.length)throw"zetaPush.on - bad arguments";var r={};r.channel=i.generateChannel(e,t,n),r.callback=o,g.push(r)}var s=r.channel.split("/");if(s.length<=1)return a.notifyListeners("/meta/error","Syntax error in the channel name"),null;if("service"==s[1])r.isService=!0,u?(r.sub=a.subscribe(r.channel,r.callback),log.debug("subscribed",r)):log.debug("queuing subscription request",r);else{if("meta"!=s[1])return log.error("This event can t be managed by ZetaPush",evt),null;r.isService=!1,r.sub=a.addListener(r.channel,r.callback)}return null==r.renewOnReconnect&&(r.renewOnReconnect=!0),r},i.off=function(e){e&&null!=e.sub&&(e.isService?(a.unsubscribe(e.sub),e.sub=null):(a.removeListener(e.sub),e.sub=null),log.debug("unsubscribed",e),e.renewOnReconnect=!1)},i.send=function(e,t,n,o){var r,s;2==arguments.length||1==arguments.length?(r=arguments[0],s=arguments[1]):(3==arguments.length||4==arguments.length)&&(r=i.generateChannel(e,t,n),s=o);var c=r.split("/");return c.length<=1?void a.notifyListeners("/meta/error","Syntax error in the channel name"):void("service"==c[1]?u&&a.publish(r,s):"meta"==c[1]&&a.notifyListeners(r,s))},i.disconnect=function(){a.disconnect(!0)},i.getServerUrl=function(){return f},i.getRestServerUrl=function(){return f+"/rest/deployed"},a.onListenerException=function(e,t,n,o){log.error("Uncaught exception for subscription",t,":",e,"message:",o),n?(a.removeListener(t),log.error("removed listener")):(a.unsubscribe(t),log.error("unsubscribed"))},i.refresh=function(){log.debug("refreshing subscriptions");var e=[];g.forEach(function(t){t.sub&&(t.isService?a.unsubscribe(t.sub):a.removeListener(t.sub)),t.renewOnReconnect&&e.push(t)}),e.forEach(function(e){i.on(e)})},i.makeResourceId=function(){for(var e="",t="abcdefghijklmnopqrstuvwxyz0123456789",n=0;5>n;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},i.reconnect=function(){connect(c)},i.getBusinessId=function(){return l},s.zp=r}.call(window),function(){function e(){}var t=e.prototype,n=this;t.on=function(e,t){return zp.on(zp.generateChannel(this._deploymentId,e),t)},t.off=function(e){zp.off(e)},t.send=function(e,t){zp.send(zp.generateChannel(this._deploymentId,e),t)},t.onError=function(e){this._subscribeKeyArray.push(this.on("error",e))},t.releaseService=function(){var e=this;this._subscribeKeyArray.forEach(function(t,n){e.off(t)})},n.zp.service._base=e}.call(window),function(){function e(e){this._deploymentId=e,this._subscribeKeyArray=[]}e.prototype=Object.create(zp.service._base.prototype);var t=(e.prototype,this);t.zp.service.Generic=e}.call(window),function(){function e(e){o=e,zp.on("/meta/handshake",function(e){e.successful&&(t=e.ext.authentication.userId,n=e.ext.authentication.token)})}var t,n,o,r=e.prototype,i=this;r.getUserId=function(){return t},r.getToken=function(){return n},r.getConnectionData=function(e,t,n){var r,i,s=zp.getBusinessId()+"."+o+".simple";2===arguments.length?(r={token:e},i=t):(r={login:e,password:t},i=n);var a={ext:{authentication:{action:"authenticate",type:s,resource:i,data:r}}};return a},i.zp.authent.Simple=e}.call(window),function(){function e(e){i=e,r=zp.getBusinessId()+"."+i+".weak",zp.on("/meta/handshake",function(e){e.successful&&(t=e.ext.authentication.token,n=e.ext.authentication.publicToken,o=e.ext.authentication.userId)}),zp.on(zp.generateChannel(i,"control"),function(e){console.log("control",e),zp.isConnected(r)&&zp.reconnect()}),zp.on(zp.generateChannel(i,"release"),function(e){console.log("release",e),zp.isConnected(r)&&zp.reconnect()})}var t,n,o,r,i,s=e.prototype,a=this;s.getConnectionData=function(e,n){var o={token:e};t&&(o={token:t});var i={ext:{authentication:{action:"authenticate",type:r,resource:n,data:o}}};return i},s.getUserId=function(){return o},s.getToken=function(){return t},s.getPublicToken=function(){return n},s.getQRCodeUrl=function(e){return zp.getRestServerUrl()+"/"+zp.getBusinessId()+"/"+i+"/weak/qrcode/"+e},a.zp.authent.Weak=e}.call(window);